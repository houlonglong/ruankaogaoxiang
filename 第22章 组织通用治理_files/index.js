var WebAegis=function(){"use strict";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t={exports:{}};t.exports=function(){var e,t;function n(t){this.name="__st"+(1e9*Math.random()>>>0)+e+"__",null!=t&&t.forEach(this.add,this),e+=1}Array.prototype.find||Object.defineProperty(Array.prototype,"find",{configurable:!0,writable:!0,value:function(e){if(null===this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var r=arguments[1],o=0;o<n;){var i=t[o];if(e.call(r,i,o,t))return i;o+=1}}}),window.WeakSet||(e=Date.now()%1e9,n.prototype.add=function(e){var t=this.name;return e[t]||Object.defineProperty(e,t,{value:!0,writable:!0}),this},n.prototype.delete=function(e){return!!e[this.name]&&!(e[this.name]=void 0)},n.prototype.has=function(e){return!!e[this.name]},t=n,Object.defineProperty(window,"WeakSet",{value:function(e){return new t(e)}})),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<arguments.length;n++)if(null!=(r=arguments[n]))for(var r=Object(r),o=Object.keys(Object(r)),i=0,a=o.length;i<a;i++){var c=o[i],s=Object.getOwnPropertyDescriptor(r,c);null!=s&&s.enumerable&&(t[c]=r[c])}return t}});var r=function(e,t){return(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)},o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function i(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,c=i.length;a<c;a++,o++)r[o]=i[a];return r}var a=/_?t(\d)?(imestamp)?=\d+&?/g,c=["aegis.qq.com","tamaegis.com","/aegis-sdk","rumt-","/flog.core.min.js","pingfore.qq.com","pingfore.tencent.com","zhiyan.tencent-cloud.net","h.trace.qq.com","btrace.qq.com","beacon.qq.com","dmplog.qq.com","qq.com/report","svibeacon.onezapp.com","cube.weixinbridge.com","doubleclick.net","pcmgrmonitor.3g.qq.com","tdm.qq.com","report.qqweb.qq.com","tpstelemetry.tencent.com","insight.cloud.tencent.com","facebook.com","facebook.net","google","yahoo.com","twitter.com","ga-audiences","report.idqqimg.com","arms-retcode.aliyuncs.com","px.effirst.com","sentry","baidu.com","hot-update.json","u.c.b.r.o.w.s.e.r","report.url.cn","sockjs-node","m3u8"],s=["ResizeObserver loop limit exceeded","ResizeObserver loop completed","Failed to execute 'transaction'","window.indexedDB.deleteDatabase is not a function"],u=["ext1","ext2","ext3","level","trace","tag","seq","code"],l=["static","fetch"],f=(g.prototype.indexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n].callback===t)return n;return-1},g.prototype.on=function(e,t,n){var r;if(void 0===n&&(n=0),this)return(r=this.eventsList[e])||(this.eventsList[e]=[],r=this.eventsList[e]),-1===this.indexOf(r,t)&&r.push({name:e,type:n||0,callback:t}),this},g.prototype.one=function(e,t){this.on(e,t,1)},g.prototype.remove=function(e,t){if(this){var n=this.eventsList[e];if(n){if(t)return n.length&&(t=this.indexOf(n,t),n.splice(t,1)),this;try{delete this.eventsList[e]}catch(e){}}return null}},g.prototype.clear=function(){this.eventsList={}},g),d={generateTraceId:h(16),generateSpanId:h(8)},p=Array(32);function g(){var e=this;this.emit=function(t,n){if(e){var r;if(null!=(o=e.eventsList[t])&&o.length)for(var o=o.slice(),i=0;i<o.length;i++){r=o[i];try{var a=r.callback.apply(e,[n]);if(1===r.type&&e.remove(t,r.callback),!1===a)break}catch(t){throw t}}return e}},this.eventsList={}}function h(e){return function(){for(var t=0;t<2*e;t++)p[t]=Math.floor(16*Math.random())+48,58<=p[t]&&(p[t]+=39);return String.fromCharCode.apply(null,p.slice(0,2*e))}}function m(){return([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,(function(e){return(e^(16*Math.random()&15)>>e/4).toString(16)}))}function v(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function y(e){for(var t,n,r,o="",i=0,a=(e=String(e)).length%3;i<e.length;){if(255<(t=e.charCodeAt(i++))||255<(n=e.charCodeAt(i++))||255<(r=e.charCodeAt(i++)))throw new TypeError("Failed to execute 'btoa': The string to be encoded contains characters outside of the Latin1 range.");o+=b.charAt((t=t<<16|n<<8|r)>>18&63)+b.charAt(t>>12&63)+b.charAt(t>>6&63)+b.charAt(63&t)}return a?o.slice(0,a-3)+"===".substring(a):o}function w(e){if(e=String(e).replace(/[\t\n\f\r ]+/g,""),!O.test(e))throw new TypeError("Failed to execute 'atob': The string to be decoded is not correctly encoded.");var t;e+="==".slice(2-(3&e.length));for(var n,r,o="",i=0;i<e.length;)t=b.indexOf(e.charAt(i++))<<18|b.indexOf(e.charAt(i++))<<12|(n=b.indexOf(e.charAt(i++)))<<6|(r=b.indexOf(e.charAt(i++))),o+=64===n?String.fromCharCode(t>>16&255):64===r?String.fromCharCode(t>>16&255,t>>8&255):String.fromCharCode(t>>16&255,t>>8&255,255&t);return o}function E(e){var t,n="";return"object"==typeof e&&(t=(e=function(e,t){for(var n=0;n<t.length;n++){var r=t[n],o=e[r]||"function"==typeof e.get&&e.get(r);if(o)return[r,o]}return["",""]}(e,Object.keys(T)))[0],e=e[1],t)?T[t](e):n}var R,b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",O=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,S=(_.prototype.generate=function(e,t,n){if(void 0===t&&(t={}),this.url=e,!this.isUrlIgnored()&&this.isUrlInTraceUrls()&&this.traceType){switch(this.traceType){case"traceparent":this.traceId=this.createTraceparent();break;case"b3":this.traceId=this.createB3();break;case"sw8":this.traceId=this.createSw8(n);break;case"sentry-trace":this.traceId=this.createSentryTrace();break;default:return console.warn("this trace key "+this.traceType+" is not supported"),void(this.traceId="")}return t[this.traceType]&&(this.traceId=t[this.traceType]),{name:this.traceType,value:this.traceId}}},_.prototype.createTraceparent=function(){var e=d.generateSpanId();return"00-"+d.generateTraceId()+"-"+e+"-0"+Number(1).toString(16)},_.prototype.createB3=function(){var e=d.generateSpanId();return d.generateTraceId()+"-"+e+"-1"},_.prototype.createSw8=function(e){var t="function"==typeof btoa?btoa:y,n=void 0===(n=(e=e||{}).host)?"":n,r=(e=void 0===(e=e.pathname)?"":e,v()),o=v();return"1-"+String(t(o))+"-"+String(t(r))+"-1-"+String(t("aegis"))+"-"+String(t("1.38.6"))+"-"+String(t(encodeURI(e)))+"-"+String(t(n))},_.prototype.createSentryTrace=function(){var e=m().substring(16);return m()+"-"+e+"-1"},_.prototype.isUrlIgnored=function(){if(Array.isArray(this.ignoreUrls)&&0!==this.ignoreUrls.length)for(var e=0,t=this.ignoreUrls;e<t.length;e++){var n=t[e];if(this.urlMatches(this.url,n))return!0}return!1},_.prototype.isUrlInTraceUrls=function(){if(!this.urls)return!0;if(Array.isArray(this.urls)){if(0===this.urls.length)return!1;for(var e=0,t=this.urls;e<t.length;e++){var n=t[e];if(this.urlMatches(this.url,n))return!0}}return!1},_.prototype.urlMatches=function(e,t){return"string"==typeof t?e===t:!!e.match(t)},_),T={sw8:function(e){var t="function"==typeof atob?atob:w;return(e=e.split("-")[1])?t(e):""},traceparent:function(e){return e.split("-")[1]},b3:function(e){return e.split("-")[0]},"sentry-trace":function(e){return e.split("-")[0]}},x=function(e){if(!e||0===e.length)return"{}";e=Array.isArray(e)?e:[e];var t=Object.keys(e[0]),n={};return t.forEach((function(t){n[t]=e.map((function(e){return e[t]}))})),n.count=e.length,Z(n)};function _(e,t,n){void 0===n&&(n=null),this.traceType=e,this.ignoreUrls=t,this.urls=n}function P(e,t){return"number"==typeof e||"string"==typeof e?e:t?R.string:R.number}function A(e,t){return"string"==typeof e?e.split("?")[t?1:0]||"":e}function C(e,t){return void 0===t&&(t=2048),String(e).replace(a,"").slice(0,t)}function I(e){return"string"==typeof e&&/^\//.test(e)?"https:"===(null===location||void 0===location?void 0:location.protocol):/^https/.test(e)}function L(e,t,n){var r,o;try{if("function"==typeof(null==t?void 0:t.retCodeHandler))return{code:void 0===(i=(o=t.retCodeHandler(e,null==n?void 0:n.url,null==n?void 0:n.ctx,null==n?void 0:n.payload)||{}).code)?"unknown":i,isErr:o.isErr};if(!(e="string"==typeof e?JSON.parse(e):e))return{code:"unknown",isErr:!1};"function"==typeof(null==(r=null==t?void 0:t.ret)?void 0:r.join)&&(Y=[].concat(t.ret.map((function(e){return e.toLowerCase()}))));var i,a=Object.getOwnPropertyNames(e).filter((function(e){return-1!==Y.indexOf(e.toLowerCase())}));return a.length?{code:""+(i="未知"!==(i=e[a[0]])&&""!==i?i:"unknown"),isErr:0!==i&&"0"!==i&&"unknown"!==i}:{code:"unknown",isErr:!1}}catch(e){return{code:"unknown",isErr:!1}}}function k(e,t,n){try{var r="function"==typeof t?t(e,null==n?void 0:n.url)||"":e;return ee(r).slice(0,102400)}catch(e){return""}}function N(e,t){return"string"!=typeof e||!e||t&&-1<e.indexOf(t)||re.test(e)||c.some((function(t){return-1<e.indexOf(t)}))}function U(e,t){var n,r=[],o=e.config;return e.lifeCycle.on("destroy",(function(){r.length=0})),function(i,a){Array.isArray(i)?r=r.concat(i):r.push(i),t&&r.length>=t||e.sendNow&&0<r.length?(r=oe(r),a(r.splice(0,r.length)),n&&clearTimeout(n)):(n&&clearTimeout(n),n=setTimeout((function(){n=null,0<(r=oe(r)).length&&a(r.splice(0,r.length))}),o.delay))}}function M(e,t){return Array.isArray(e)?t(e.map((function(e){return t=o(o({},e),{msg:"string"==typeof e.msg?e.msg:[].concat(e.msg).map(Q).join(" ")}),u.forEach((function(e){t[e]||delete t[e]})),t;var t}))):t([o(o({},e),{msg:"string"==typeof e.msg?e.msg:Q(e.msg)})])}function D(e,t){return function(n,r){var i,a,c,s=Array.isArray(n),l=s?n:[n],f=(e.lifeCycle.emit("beforeRequest",n),e.config.beforeRequest);(l="function"==typeof f?l.map((function(e){try{var n=f({logs:e,logType:t});return(null==n?void 0:n.logType)===t&&null!=n&&n.logs?n.logs:!1!==n&&e}catch(n){return e}})).filter((function(e){return!1!==e})):l).length&&(i=l,n=u,!Array.isArray(i)||i.length<=1||(a=[],c=[],!(c="string"==typeof n?[n]:n))||c.length<=0||(c.forEach((function(e){i.forEach((function(t){null!=t&&t[e]&&a.push(e)}))})),0<a.length&&(i=i.map((function(e){var t={};return a.forEach((function(e){t[e]=""})),o(o({},t),e)})))),l=i,r(s?l:l[0]))}}function H(e){return function(t,n){e.lifeCycle.emit("modifyRequest",t);var r=e.config.modifyRequest;if("function"==typeof r)try{var o=r(t);"object"==typeof o&&"url"in o&&(t=o)}catch(t){console.error(t)}n(t)}}function j(e){return function(t,n){null!=(r=e.lifeCycle)&&r.emit("afterRequest",t);var r=(e.config||{}).afterRequest;"function"==typeof r&&!1===r(t)||n(t)}}function q(e){if(e&&e.reduce&&e.length)return 1===e.length?function(t,n){e[0](t,n||fe)}:e.reduce((function(e,t){return function(n,r){return void 0===r&&(r=fe),e(n,(function(e){return null==t?void 0:t(e,r)}))}}));throw new TypeError("createPipeline need at least one function param")}function B(e,t){Object.getOwnPropertyNames(e).forEach((function(n){"function"==typeof e[n]&&"constructor"!==n&&(t?t[n]="sendPipeline"===n?function(){return function(){}}:function(){}:e[n]=function(){})}))}function F(){return void 0!==window.performance&&"function"==typeof performance.getEntriesByType&&"function"==typeof performance.now}function W(e,t){function n(e,t,n,r){function o(i){"visibilitychange"===e&&"hidden"!==document.visibilityState||(r?setTimeout((function(){return t(i)}),r):t(i),n&&removeEventListener(e,o,!0))}addEventListener(e,o,!0)}var r;n("visibilitychange",e,null==t?void 0:t.once,null==(r=null==t?void 0:t.delay)?void 0:r.visibilitychange),n("pagehide",e,null==t?void 0:t.once,null==(r=null==t?void 0:t.delay)?void 0:r.pagehide)}function G(e){return-1!==ye.indexOf(e)}(de=R=R||{})[de.number=-1]="number",de.string="";var V,X,J,$=["application/xhtml+xml","application/xml","application/pdf","application/pkcs12","application/javascript","application/x-javascript","application/ecmascript","application/vnd.mspowerpoint","application/vnd.apple.mpegurl","application/ogg","text/css","text/javascript","image","audio","video","video/mp2t"],K=/\.(json|js|css|jpg|jpeg|png|svg|apng|webp|gif|bmp|mp4|mp3|ts|mpeg|wav|webm|ogg|flv|m3u8|ttf|woff2|otf|eot|woff|html|htm|shtml|shtm|)$/gi,Y=["ret","retcode","code","errcode"],z=function(){var e=new WeakSet;return function(t,n){if(n instanceof Error)return"Error.message: "+n.message+" \n  Error.stack: "+n.stack;if("object"==typeof n&&null!==n){if(e.has(n))return"[Circular "+(t||"root")+"]";e.add(n)}return n}},Q=function(e){if("string"==typeof e)return e;try{return e instanceof Error?(JSON.stringify(e,z(),4)||"undefined").replace(/"/gim,""):JSON.stringify(e,z(),4)||"undefined"}catch(e){return"error happen when aegis stringify: \n "+e.message+" \n "+e.stack}},Z=function(e){if("string"==typeof e)return e;try{return JSON.stringify(e,z())||"undefined"}catch(e){return"error happen when aegis stringify: \n "+e.message+" \n "+e.stack}},ee=function(e,t){void 0===t&&(t=3);var n,r,o,i="";return Array.isArray(e)?(i+="[",n=e.length,e.forEach((function(e,r){i=(i+="object"==typeof e&&1<t?ee(e,t-1):ne(e))+(r===n-1?"":",")})),i+="]"):e instanceof Object?(i="{",r=Object.keys(e),o=r.length,r.forEach((function(n,a){"object"==typeof e[n]&&1<t?i+='"'+n+'":'+ee(e[n],t-1):i+=te(n,e[n]),i+=a===o-1||a<o-1&&void 0===e[r[a+1]]?"":","})),i+="}"):i+=e,i},te=function(e,t){var n=typeof t,r="";return"string"==n||"object"==n?r+='"'+e+'":"'+t+'"':"function"==typeof t?r+='"'+e+'":"function '+t.name+'"':"symbol"==typeof t?r+='"'+e+'":"symbol"':"number"!=typeof t&&"boolean"!=n||(r+='"'+e+'": '+t),r},ne=function(e){var t=typeof e;return""+("undefined"==t||"symbol"==t||"function"==t?"null":"string"==t||"object"==t?'"'+e+'"':e)},re=/data:(image|text|application|font)\/.*;base64/,oe=((de=V=V||{}).INFO_ALL="-1",de.API_RESPONSE="1",de.INFO="2",de.ERROR="4",de.PROMISE_ERROR="8",de.AJAX_ERROR="16",de.SCRIPT_ERROR="32",de.IMAGE_ERROR="64",de.CSS_ERROR="128",de.CONSOLE_ERROR="256",de.MEDIA_ERROR="512",de.RET_ERROR="1024",de.REPORT="2048",de.PV="4096",de.EVENT="8192",de.PAGE_NOT_FOUND_ERROR="16384",de.WEBSOCKET_ERROR="32768",de.BRIDGE_ERROR="65536",de.LAZY_LOAD_ERROR="131072",(de=X=X||{}).LOG="log",de.SPEED="speed",de.PERFORMANCE="performance",de.OFFLINE="offline",de.WHITE_LIST="whiteList",de.VITALS="vitals",de.PV="pv",de.CUSTOM_PV="customPV",de.EVENT="event",de.CUSTOM="custom",de.SDK_ERROR="sdkError",de.SET_DATA="setData",de.LOAD_PACKAGE="loadPackage",(de=J=J||{}).production="production",de.development="development",de.gray="gray",de.pre="pre",de.daily="daily",de.local="local",de.test="test",de.others="others",function(e){return e.filter((function(t,n){return"static"!==t.type||!e.find((function(e,r){return t.url===e.url&&200===t.status&&n<r}))}))}),ie=function(e){e.level===V.INFO_ALL&&(e.level=V.INFO)},ae={},ce={},se=function(e){return ae[e]||(ae[e]=setTimeout((function(){ce[e]={},ae[e]=null}),6e4)),ae[e]},ue=function(e){return(Array.isArray(e)?e:[e]).map((function(e){return Object.getOwnPropertyNames(e).reduce((function(t,n){return"ctx"!==n&&(t[n]=e[n]),t}),{level:V.INFO,msg:""})}))},le=function(e){return function(t){return e.sendPipeline([function(t,n){return n({url:e.config.url||"",data:x(ue(t)),method:"post",contentType:"application/json",type:X.LOG,log:t,requestConfig:{timeout:5e3},success:function(){var r=e.config.onReport;"function"==typeof r&&t.forEach((function(e){r(e)})),"function"==typeof n&&n([])}})}],X.LOG)(t)}},fe=function(){},de=(Object.defineProperty(Re.prototype,"__version__",{get:function(){return console.warn("__version__ has discard, please use version"),"1.38.6"},enumerable:!1,configurable:!0}),Object.defineProperty(Re.prototype,"LogType",{get:function(){return console.warn("LogType has discard, please use logType"),V},enumerable:!1,configurable:!0}),Re.prototype.init=function(e){this.setConfig(e);for(var t=0;t<Re.installedPlugins.length;t++)try{Re.installedPlugins[t].patch(this)}catch(e){this.sendSDKError(e)}this.lifeCycle.emit("onInited")},Re.prototype.setConfig=function(e){Object.assign(this.config,e);var t=(e=this.config).id,n=e.uin,r=e.version,o=e.ext1,i=e.ext2,a=e.ext3,c=e.aid,s=void 0===(u=e.env)?"production":u,u=e.pageUrl;return e=this.bean.id!==t||this.bean.uin!==n||this.bean.aid!==c,this.bean.id=t||"",this.bean.uin=n||"",this.bean.version=r||"1.38.6",this.bean.aid=c||"",this.bean.env=function(){switch(s){case J.production:case J.development:case J.gray:case J.pre:case J.daily:case J.local:case J.test:case J.others:return 1;default:return}}()?s:J.others,u&&this.extendBean("from",encodeURIComponent(u.slice(0,2048))),o&&this.extendBean("ext1",encodeURIComponent(o)),i&&this.extendBean("ext2",encodeURIComponent(i)),a&&this.extendBean("ext3",encodeURIComponent(a)),e&&this.lifeCycle.emit("onConfigChange",this.config),this.config},Re.use=function(e){-1===Re.installedPlugins.indexOf(e)&&e.aegisPlugin&&Re.installedPlugins.push(e)},Re.unuse=function(e){-1!==(e=Re.installedPlugins.indexOf(e))&&Re.installedPlugins.splice(e,1)},Re.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:V.INFO,msg:e};1===e.length&&e[0].msg&&Object.assign(n,o({},e[0]),{level:V.INFO}),this.normalLogPipeline(n)},Re.prototype.infoAll=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:V.INFO_ALL,msg:e};1===e.length&&e[0].msg&&Object.assign(n,o({},e[0]),{level:V.INFO_ALL}),this.normalLogPipeline(n)},Re.prototype.report=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:V.REPORT,msg:e};1===e.length&&e[0].msg&&Object.assign(n,o({},e[0])),this.normalLogPipeline(n)},Re.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:V.ERROR,msg:e};1===e.length&&e[0].msg&&Object.assign(n,o({},e[0]),{level:V.ERROR}),this.normalLogPipeline(n)},Re.prototype.speedLogPipeline=function(e){throw new Error('You need to override "speedLogPipeline" method')},Re.prototype.reportPv=function(e){var t,n=this;e&&(console.warn("reportPv is deprecated, please use reportEvent"),t=""+Object.getOwnPropertyNames(this.bean).filter((function(e){return"id"!==e})).map((function(e){return e+"="+n.bean[e]})).join("&"),this.sendPipeline([function(r,o){o({url:n.config.url+"/"+e+"?"+t,addBean:!1,type:X.CUSTOM_PV})}],X.CUSTOM_PV)(null))},Re.prototype.reportEvent=function(e){e&&((e="string"==typeof e?{name:e,ext1:this.config.ext1||"",ext2:this.config.ext2||"",ext3:this.config.ext3||""}:e).name?("string"!=typeof e.name&&(console.warn("reportEvent params name must be string"),e.name=String(e.name)),this.eventPipeline(e)):console.warn("reportEvent params error"))},Re.prototype.reportTime=function(e,t){if("object"==typeof e)return this.reportT(e);"string"==typeof e?"number"==typeof t?t<0||6e4<t?console.warn("reportTime: duration must between 0 and 60000"):this.submitCustomTime(e,t):console.warn("reportTime: second param must be number"):console.warn("reportTime: first param must be a string")},Re.prototype.reportT=function(e){var t=e.name,n=e.duration,r=void 0===(r=e.ext1)?"":r,o=void 0===(o=e.ext2)?"":o,i=void 0===(i=e.ext3)?"":i;if(e=e.from,"string"==typeof t&&"number"==typeof n&&"string"==typeof r&&"string"==typeof o&&"string"==typeof i){if(!(n<0||6e4<n))return this.submitCustomTime(t,n,r,o,i,void 0===e?"":e);console.warn("reportTime: duration must between 0 and 60000")}else console.warn("reportTime: params error")},Re.prototype.time=function(e){"string"==typeof e?this.timeMap[e]?console.warn("Timer "+e+" already exists"):this.timeMap[e]=Date.now():console.warn("time: first param must be a string")},Re.prototype.timeEnd=function(e){"string"==typeof e?this.timeMap[e]?(this.submitCustomTime(e,Date.now()-this.timeMap[e]),delete this.timeMap[e]):console.warn("Timer "+e+" does not exist"):console.warn("timeEnd: first param must be a string")},Re.prototype.submitCustomTime=function(e,t,n,r,o,i){this.customTimePipeline({name:e,duration:t,ext1:n||this.config.ext1,ext2:r||this.config.ext2,ext3:o||this.config.ext3,from:i||void 0})},Re.prototype.extendBean=function(e,t){this.bean[e]=t},Re.prototype.sendPipeline=function(e,t){var n,r=this;return q(i([function(e,t){if("number"!=typeof n.config.random&&(console.warn("random must in [0, 1], default is 1."),n.config.random=1),!n.isHidden||!n.isGetSample)if(n.isGetSample)n.isHidden||t(e);else{if(n.isGetSample=!0,Math.random()<n.config.random)return n.isHidden=!1,t(e);n.isHidden=!0}},D(n=this,t)],e,[H(this),function(e,t){r.request(e,(function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var a=!1;-1<(""+n[r.failRequestCount=0]).indexOf("403 forbidden")&&(a=!0,r.destroy()),t({isErr:a,result:n,logType:null==e?void 0:e.type,logs:null==e?void 0:e.log}),null!=(a=null==e?void 0:e.success)&&a.call.apply(a,i([e],n))}),(function(){for(var n,o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];60<=++r.failRequestCount&&r.destroy(),-1<(""+o[0]).indexOf("403 forbidden")&&r.destroy(),t({isErr:!0,result:o,logType:null==e?void 0:e.type,logs:null==e?void 0:e.log}),null!=(n=null==e?void 0:e.fail)&&n.call.apply(n,i([e],o))}))},j(this)]))},Re.prototype.send=function(e,t,n){var r=this;return q([H(this),function(e,o){r.request(e,(function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];o({isErr:!1,result:n,logType:e.type,logs:e.log}),null!=t&&t.apply(void 0,n)}),(function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];o({isErr:!0,result:t,logType:e.type,logs:e.log}),null!=n&&n.apply(void 0,t)}))},j(this)])(e)},Re.prototype.ready=function(e,t,n){throw new Error('You need to override "ready" method')},Re.prototype.request=function(e,t,n){throw new Error('You need to override "request" method')},Re.prototype.sendSDKError=function(e){var t=this;this.sendPipeline([function(e,n){n({url:t.config.url+"?id=1085&msg[0]="+encodeURIComponent(Q(e))+"&level[0]=2&from="+t.config.id+"&count=1&version="+t.config.id+"(1.38.6)",addBean:!1,method:"get",type:X.SDK_ERROR,log:e})}],X.SDK_ERROR)(e)},Re.prototype.destroy=function(e){void 0===e&&(e=!1);var t,n,r=Re.instances.indexOf(this);-1!==r&&Re.instances.splice(r,1);for(var o=Re.installedPlugins.length-1;0<=o;o--)try{Re.installedPlugins[o].unpatch(this)}catch(e){this.sendSDKError(e)}if(this.lifeCycle.emit("destroy"),this.lifeCycle.clear(),e)t=this,n=Object.getOwnPropertyDescriptors(t),Object.keys(n).forEach((function(e){n[e].writable&&(t[e]=null)})),Object.setPrototypeOf(this,null);else{for(var i=this;i.constructor!==Object&&B(i,this),i=Object.getPrototypeOf(i););0===Re.instances.length&&(B(r=Object.getPrototypeOf(this).constructor),B(Re))}},Re.version="1.38.6",Re.instances=[],Re.logType=V,Re.environment=J,Re.installedPlugins=[],Re),pe=(Ee.prototype.patch=function(e){this.canUse(e)&&this.exist(e)&&(this.instances.push(e),this.triggerInit(e),this.triggerOnNewAegis(e))},Ee.prototype.unpatch=function(e){var t=this.instances.indexOf(e);-1!==t&&(this.instances.splice(t,1),0===this.instances.length)&&this.uninstall(e)},Ee.prototype.countInstance=function(){return this.instances.length},Ee.prototype.uninstall=function(e){var t;null!=(t=null==(t=this.option)?void 0:t.destroy)&&t.apply(this,[e])},Ee.prototype.walk=function(e){var t=this;this.instances.forEach((function(n){var r=t.canUse(n);r&&e(n,r)}))},Ee.prototype.canUse=function(e){return!(!(e=this.getConfig(e))||"object"!=typeof e)||!!e},Ee.prototype.getConfig=function(e){return null==(e=e.config)?void 0:e[this.name]},Ee.prototype.exist=function(e){return-1===this.instances.indexOf(e)},Ee.prototype.triggerInit=function(e){var t;this.inited||(this.inited=!0,null==(t=null==(t=this.option)?void 0:t.init))||t.call(this.option,this.getConfig(e))},Ee.prototype.triggerOnNewAegis=function(e){var t;null!=(t=null==(t=this.option)?void 0:t.onNewAegis)&&t.call(this.option,e,this.getConfig(e))},Ee),ge=new pe({name:"aid",aid:"",init:function(e){try{var t=!0!==e&&e||window.localStorage.getItem("AEGIS_ID");t||(t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),window.localStorage.setItem("AEGIS_ID",t)),this.aid=t}catch(e){}},onNewAegis:function(e){e.bean.aid=this.aid,e.config.aid=this.aid}}),he=function(e){var t;return e.payload?(t={},Object.keys(e).forEach((function(n){"payload"!==n&&(t[n]=e[n])})),t):e},me=new pe({name:"reportAssetSpeed"}),ve=me=new pe({name:"reportAssetSpeed",collectCur:0,collectEntryType:"resource",ASSETS_INITIATOR_TYPE:["img","css","script","link","audio","video"],onNewAegis:function(e){var t=this;F()&&(this.collectSuccessLog(e),this.collectFailLog(e),performance.onresourcetimingbufferfull=function(){"function"==typeof performance.clearResourceTimings&&(t.collectCur=0,performance.clearResourceTimings())})},publish:function(e,t){this.$walk((function(n){n===t&&n.speedLogPipeline(e)}))},publishMany:function(e,t){for(var n=t.config,r=0,o=e.length;r<o;r++){var i=e[r];-1===this.ASSETS_INITIATOR_TYPE.indexOf(i.initiatorType)||N(i.name,n.hostUrl)||this.publish(this.generateLog(i,n),t)}},collectSuccessLog:function(e){var t,n,r=this;"function"==typeof window.PerformanceObserver?(this.publishMany(performance.getEntriesByType(this.collectEntryType),e),(t=new window.PerformanceObserver((function(t){r.publishMany(t.getEntries(),e)}))).observe({entryTypes:[this.collectEntryType]}),e.lifeCycle.on("destroy",(function(){0===me.countInstance()&&t.disconnect()}))):(n=setInterval((function(){var t=performance.getEntriesByType(r.collectEntryType),n=t.slice(r.collectCur);r.collectCur=t.length,r.publishMany(n,e)}),3e3),e.lifeCycle.on("destroy",(function(){0===me.countInstance()&&clearInterval(n)})))},collectFailLog:function(e){function t(t){var o,i;t&&(t=t.target||t.srcElement,!(o=(null==t?void 0:t.src)||(null==t?void 0:t.href))||"string"!=typeof o||-1<window.location.href.indexOf(o)||(t="function"==typeof(null==(t=r.api)?void 0:t.resourceTypeHandler)?null==(t=r.api)?void 0:t.resourceTypeHandler(o):"",i=performance.getEntriesByType(n.collectEntryType).find((function(e){return e.name===o})),N(o,r.hostUrl))||(i={url:C(o),status:400,duration:Number(((null==i?void 0:i.duration)||0).toFixed(2)),method:"get",type:t||"static",isHttps:I(o),urlQuery:A(o,!0),nextHopProtocol:"",domainLookup:0,connectTime:0},n.publish(i,e)))}var n=this,r=e.config;window.document.addEventListener("error",t,!0),e.lifeCycle.on("destroy",(function(){0===me.countInstance()&&window.document.removeEventListener("error",t,!0)}))},generateLog:function(e,t){t="function"==typeof(null==(n=t.api)?void 0:n.resourceTypeHandler)?null==(n=t.api)?void 0:n.resourceTypeHandler(e.name):"";var n=e.transferSize;return{url:C(e.name),method:"get",duration:Number(e.duration.toFixed(2)),status:200,type:t||"static",isHttps:I(e.name),nextHopProtocol:e.nextHopProtocol||"",urlQuery:A(e.name,!0),domainLookup:P(e.domainLookupEnd-e.domainLookupStart),connectTime:P(e.connectEnd-e.connectStart),transferSize:0<n?n:-1}},collectNotReportedLog:function(e){var t,n;F()&&(t=(n=performance.getEntriesByType(this.collectEntryType)).length,"function"!=typeof window.PerformanceObserver)&&this.collectCur!==t&&(n=n.slice(this.collectCur),this.collectCur=t,this.publishMany(n,e,!0))},destroy:function(){this.option.publish=function(){}}}),ye=window.navigator.userAgent.toLowerCase(),we={};function Ee(e){this.aegisPlugin=!0,this.name="",this.instances=[],this.inited=!1,e.$walk=this.walk.bind(this),e.$getConfig=this.getConfig.bind(this),this.option=e,this.name=e.name}function Re(e){var t,n,r,o,i,a,c,s,u,l,d,p,g,h,m=this;this.isGetSample=!1,this.isHidden=!1,this.config={version:0,delay:1e3,onError:!0,repeat:60,random:1,aid:!0,device:!0,pagePerformance:!0,webVitals:!0,speedSample:!0,onClose:!0,reportLoadPackageSpeed:!0,hostUrl:"https://aegis.qq.com",env:"production",url:"",offlineUrl:"",whiteListUrl:"",pvUrl:"",speedUrl:"",customTimeUrl:"",performanceUrl:"",performanceUrlForHippy:"",webVitalsUrl:"",eventUrl:"",setDataReportUrl:"",reportImmediately:!0},this.isWhiteList=!1,this.lifeCycle=new f,this.bean={},this.normalLogPipeline=q([U(this,5),M,function(e,n){var r=t.config;n(e=e.map((function(e){var t,n=r.maxLength||102400;try{if(!e.msg||e.msg.length<=n)return e;e.msg=null==(t=e.msg)?void 0:t.substring(0,n)}catch(t){e.msg=Q(e.msg).substring(0,r.maxLength)}return e})))},(h=(t=this).config,function(e,t){var n="number"==typeof h.repeat?h.repeat:60;if(n<=0)return t(e);var r=(null==h?void 0:h.id)+"_error",o=ce[r]||{};t(e.filter((function(e){if(e.level===V.ERROR||e.level===V.PROMISE_ERROR||e.level===V.AJAX_ERROR||e.level===V.SCRIPT_ERROR||e.level===V.IMAGE_ERROR||e.level===V.CSS_ERROR||e.level===V.MEDIA_ERROR||e.level===V.RET_ERROR||e.level===V.BRIDGE_ERROR||e.level===V.PAGE_NOT_FOUND_ERROR||e.level===V.WEBSOCKET_ERROR||e.level===V.LAZY_LOAD_ERROR){if(e=e.msg.slice(0,200),o[e]>n)return ae[r]||se(r),!1;o[e]=1+~~o[e],ce[r]=o}return!0})))}),(p=this.lifeCycle.emit,g=this.config,function(e,t){var n,r=g.logCreated;return"function"==typeof r?(n=e.filter((function(e){return!1!==r(e)})),p("beforeWrite",n),t(n)):(p("beforeWrite",e),t(e))}),(d=this,setTimeout((function(){var e=void 0===(t=(n=d.config).pvUrl)?"":t,t=n.spa,n=-1<["web-sdk","mp-sdk"].indexOf("web-sdk");e&&(n&&!t||!n)&&d.sendPipeline([function(t,n){n({url:e,type:X.PV})}],X.PV)(null)}),100),function(e,t){t(e)}),(u=s=c=!1,l=[],(i=this).lifeCycle.on("onConfigChange",(function(){a&&clearTimeout(a),a=setTimeout((function(){var e,t;!u&&i.config&&(u=!0,e=i.config.whiteListUrl,(t=void 0===e?"":e)&&i.sendPipeline([function(e,n){n({url:t,type:X.WHITE_LIST,success:function(e){s=!0;try{var t=e.data||JSON.parse(e),n=t.retcode,r=t.result,o=void 0===r?{}:r,a=(0===n&&(c=o.is_in_white_list,i.isWhiteList=c,0<=o.rate)&&o.rate<=1&&(i.config.random=o.rate,i.isGetSample=!1),i.isWhiteList&&l.length?le(i)(l.splice(0),(function(){})):!i.isWhiteList&&l.length&&(l.length=0),i.config.onWhitelist);"function"==typeof a&&a(c)}catch(e){}},fail:function(){s=!0}})}],X.WHITE_LIST)(null),u=!1)}),i.config.uin?50:500)})),i.lifeCycle.on("destroy",(function(){l.length=0})),function(e,t){var n;c||null!=(n=null==(n=i.config)?void 0:n.api)&&n.reportRequest?t(e.concat(l.splice(0)).map((function(e){return ie(e),e}))):(n=e.filter((function(e){return e.level!==V.INFO&&e.level!==V.API_RESPONSE?(ie(e),!0):(s||(l.push(e),200<=l.length&&(l.length=200)),!1)}))).length&&t(n)}),function(e,t){try{var n=JSON.parse(JSON.stringify(e)),r=(m.lifeCycle.emit("beforeReport",n),m.config.beforeReport);(e="function"==typeof r?e.filter((function(e){return!1!==r(e)})):e).length&&t(e)}catch(e){}},le(this)]),this.eventPipeline=q([U(this,10),(o=this,function(e){o.sendPipeline([function(e,t){var n=e.map((function(e){return{name:e.name,ext1:e.ext1||o.config.ext1||"",ext2:e.ext2||o.config.ext2||"",ext3:e.ext3||o.config.ext3||""}}));t({url:o.config.eventUrl+"?payload="+encodeURIComponent(JSON.stringify(n)),type:X.EVENT,log:e})}],X.EVENT)(e)})]),this.timeMap={},this.failRequestCount=0,this.customTimePipeline=q([U(this,10),(r=this,function(e){return r.sendPipeline([function(e,t){t({url:r.config.customTimeUrl+"?payload="+encodeURIComponent(JSON.stringify({custom:e})),type:X.CUSTOM,log:e})}],X.CUSTOM)(e)})]),this.config=(n=this.config,void 0===(e=e.hostUrl)&&(e="https://aegis.qq.com"),n.url=n.url||e+"/collect",n.offlineUrl=n.offlineUrl||e+"/offline",n.whiteListUrl=n.whiteListUrl||e+"/collect/whitelist",n.pvUrl=n.pvUrl||e+"/collect/pv",n.eventUrl=n.eventUrl||e+"/collect/events",n.speedUrl=n.speedUrl||e+"/speed",n.customTimeUrl=n.customTimeUrl||e+"/speed/custom",n.performanceUrl=n.performanceUrl||e+"/speed/performance",n.performanceUrlForHippy=n.performanceUrlForHippy||e+"/speed/hippyPerformance",n.webVitalsUrl=n.webVitalsUrl||e+"/speed/webvitals",n.setDataReportUrl=n.SetDataReportUrl||e+"/speed/miniProgramData",n),Re.instances.push(this)}function be(){return{host:new URL(location.href).host,pathname:location.pathname}}function Oe(e,t,n){return null!=t&&t.length&&"object"==typeof e?t.reduce((function(t,r){var o=window.Headers&&e instanceof Headers?e.get(r):e[r];return o?t+(""===t?"":"\n\n")+n+" header "+r+": "+o:t}),""):""}function Se(e,t){return e&&-1===["null","undefined"].indexOf(e)?t+": "+e:""}we.macos=function(){return G("mac")},we.ios=function(){return we.iphone()||we.ipod()||we.ipad()},we.iphone=function(){return!we.windows()&&G("iphone")},we.ipod=function(){return G("ipod")},we.ipad=function(){var e="MacIntel"===navigator.platform&&1<navigator.maxTouchPoints;return G("ipad")||e},we.android=function(){return!we.windows()&&G("android")},we.androidPhone=function(){return we.android()&&G("mobile")},we.androidTablet=function(){return we.android()&&!G("mobile")},we.blackberry=function(){return G("blackberry")||G("bb10")},we.blackberryPhone=function(){return we.blackberry()&&!G("tablet")},we.blackberryTablet=function(){return we.blackberry()&&G("tablet")},we.windows=function(){return G("windows")},we.windowsPhone=function(){return we.windows()&&G("phone")},we.windowsTablet=function(){return we.windows()&&G("touch")&&!we.windowsPhone()},we.fxos=function(){return(G("(mobile")||G("(tablet"))&&G(" rv:")},we.fxosPhone=function(){return we.fxos()&&G("mobile")},we.fxosTablet=function(){return we.fxos()&&G("tablet")},we.meego=function(){return G("meego")},we.cordova=function(){return window.cordova&&"file:"===location.protocol},we.nodeWebkit=function(){return"object"==typeof window.process},we.mobile=function(){return we.androidPhone()||we.iphone()||we.ipod()||we.windowsPhone()||we.blackberryPhone()||we.fxosPhone()||we.meego()},we.tablet=function(){return we.ipad()||we.androidTablet()||we.blackberryTablet()||we.windowsTablet()||we.fxosTablet()},we.desktop=function(){return!we.tablet()&&!we.mobile()};var Te,xe,_e,Pe,Ae,Ce,Ie,Le=!(we.isIE=function(){return"ActiveXObject"in window}),ke=[],Ne=/^\/[^/]/,Ue=!1,Me=[],De=(new pe({name:"reportApiSpeed"}),new pe({name:"reportApiSpeed",override:!1,onNewAegis:function(e){var t,n;this.override||(null!=(n=e.config.api)&&n.injectTraceHeader&&(this.traceRequestHeader=new S(n.injectTraceHeader,null!=(t=null==n?void 0:n.injectTraceIgnoreUrls)?t:[],null==n?void 0:n.injectTraceUrls)),this.override=!0,this.overrideFetch(e.config,e),this.overrideXhr(e.config,e))},getRequestType:function(e,t,n){var r,o;return void 0===t&&(t=""),e="function"==typeof(null==(o=e.api)?void 0:o.resourceTypeHandler)?null==(o=e.api)?void 0:o.resourceTypeHandler(n):"",-1===l.indexOf(e)&&(r=void 0===t?"":t,o=(void 0===n?"":n).split("?")[0],e=K.test(o)||$.some((function(e){return-1!==String(r).indexOf(e)}))?"static":"fetch"),e},overrideFetch:function(e,t){var n=this,r=e.api,o=(r={name:this.name,traceRequestHeader:null!=r&&r.injectTraceHeader?this.traceRequestHeader:null,then:function(r,o,i,a){var c,s;N(i,e.hostUrl)||(c=r.headers?r.headers.get("content-type"):"","fetch"===(s=n.getRequestType(e,c,i))?r.clone().text().then((function(c){var u,l=r.status<=0||400<=r.status,f=(null==(f=e.api)?void 0:f.reqHeaders)||[],d=Oe(null==a?void 0:a.headers,f,"req"),p=(f=(null==(f=e.api)?void 0:f.resHeaders)||[],Oe(r.headers,f,"res")),g=E(null==a?void 0:a.headers),h=(f=L(c,e.api,{url:i,ctx:r,payload:null==a?void 0:a.body})).code,m=f.isErr,v=(f=null==(f=e.api)?void 0:f.apiDetail)?k(null==a?void 0:a.body,null==(u=e.api)?void 0:u.reqParamHandler,{url:i}):"",y=f?k(c,null==(u=e.api)?void 0:u.resBodyHandler,{url:i,ctx:r}):"";setTimeout((function(){var u=n.getPerformanceEntryByUrl(e,{url:i,duration:o,type:s,status:r.status||0,method:(null==a?void 0:a.method)||"get"}),f=[l?"FETCH_ERROR: "+c:"","fetch req url: "+i,"res status: "+(u.status||0),"res duration: "+u.duration+"ms",d,p,"req method: "+(u.method||"GET"),"res retcode: "+h,Se(v,"req param"),Se(y,"res data")].filter((function(e){return e})).join("\n\n");u.payload=null==a?void 0:a.body,u.ret=h,u.isErr=+m,n.publishNormalLog({msg:f,level:l?V.AJAX_ERROR:m?V.RET_ERROR:V.API_RESPONSE,code:h,trace:g},t),n.publishSpeed(u,t)}),0)})):setTimeout((function(){var c=n.getPerformanceEntryByUrl(e,{url:i,duration:o,type:s,status:r.status||0,method:(null==a?void 0:a.method)||"get"});c.type="static",c.urlQuery=A(i,!0),n.publishSpeed(c,t)}),0))},catch:function(r,o,i,a){var c,s,u,l,f;throw N(i,e.hostUrl)||(c=n.getRequestType(e,"",i),s=(null==(s=e.api)?void 0:s.reqHeaders)||[],u=Oe(null==a?void 0:a.headers,s,"req"),l=E(null==a?void 0:a.headers),f=null!=(s=e.api)&&s.apiDetail?k(null==a?void 0:a.body,null==(s=e.api)?void 0:s.reqParamHandler,{url:i}):"",setTimeout((function(){var s=n.getPerformanceEntryByUrl(e,{url:i,duration:o,type:c,status:0,method:(null==a?void 0:a.method)||"get"});n.publishSpeed(s,t),s="AJAX_ERROR: "+r+"\n                          \nreq url: "+i+"\n                          \nres status: 0\n                          \nres duration: "+s.duration+"ms\n                          \nreq method: "+((null==a?void 0:a.method)||"get")+"\n                          \nreq param: "+f+"\n                          \n"+u,n.publishNormalLog({msg:s,level:V.AJAX_ERROR,code:-400,trace:l},t)}),0)),r}},this.hackFetchOptions=r,this.hackFetchOptions),i=null==(r=e.api)?void 0:r.ignoreHackReg;if(void 0===i&&(i=/\.flv(\?|$)/gi),Me.find((function(e){return e.name===o.name})))throw new Error("name '"+o.name+"' is already in hackFetch option list");Me.push(o),!Ue&&window.fetch&&(Ue=!0,Pe=window.fetch,window.fetch=function(e,t){void 0===t&&(t={});var n="string"==typeof e?e:null==e?void 0:e.url;if(null!=(s=null==i?void 0:i.test)&&s.call(i,n))return Pe(n,t);Ne.test(n)&&(n=""+location.origin+n);var r,a,c,s=(o||{}).traceRequestHeader;s&&(r=void 0===(r=(t||{}).headers)?{}:r,a=(c=be()).host,c=c.pathname,a=(s=s.generate(n,r,{host:a,pathname:c})||{}).name,c=s.value)&&a&&(t.headers=Object.assign(r,((s={})[a]=c,s)));for(var u=0;u<Me.length;u++){var l=Me[u];try{"function"==typeof l.beforeFetch&&l.beforeFetch(n,t)}catch(e){}}var f=Date.now();return Pe(e,t).then((function(e){for(var r=e.clone(),o=0;o<Me.length;o++){var i=Me[o];try{"function"==typeof i.then&&i.then(r,Date.now()-f,n,t)}catch(e){}}return r})).catch((function(e){for(var r=0;r<Me.length;r++){var o=Me[r];try{"function"==typeof o.catch&&o.catch(e,Date.now()-f,n,t)}catch(e){}}throw e}))})},overrideXhr:function(e,t){var n,r=this,o={name:this.name,ignoreHackReg:null==(o=e.api)?void 0:o.ignoreHackReg,send:function(n,o){var i,a,c=Date.now(),s=(((null==e?void 0:e.api)||{}).injectTraceHeader&&(a=(i=be()).host,i=i.pathname,i=(a=r.traceRequestHeader.generate(n.aegisUrl,{},{host:a,pathname:i})||{}).name,a=a.value,i)&&a&&n.setRequestHeader(i,a),n.addEventListener("loadend",(function(){var i,a,f,d,p=n.aegisUrl||"";N(p,e.hostUrl)||"abort"===n.failType||(i="",(n.failType||!n.status||400<=n.status)&&(i=n.failType||"failed"),a=Date.now()-c,f=n.getResponseHeader("content-type"),d=r.getRequestType(e,f,p),setTimeout((function(){var c=r.getPerformanceEntryByUrl(e,{url:p,duration:a,type:d,status:n.status,method:n.aegisMethod||"get"});if("fetch"===d){var f=(null==(f=e.api)?void 0:f.reqHeaders)||[],g=Oe(n.aegisXhrReqHeader,f,"req"),h=(f=(null==(f=e.api)?void 0:f.resHeaders)||[],n.getAllResponseHeaders().split("\r\n").reduce((function(e,t){return(t=t.split(": "))[0]&&t[1]&&(e[t[0]]=t[1]),e}),{})),m=Oe(h,f,"res"),v=E(n.aegisXhrReqHeader),y=(f=null==(h=e.api)?void 0:h.apiDetail)?k(o,null==(h=e.api)?void 0:h.reqParamHandler,{url:p}):"",w=f?k(n.response,null==(h=e.api)?void 0:h.resBodyHandler,{url:p}):"";try{!function(e,t,n,r){var o,i,a,c;try{if("function"==typeof(null==t?void 0:t.retCodeHandlerAsync))return t.retCodeHandlerAsync(e,null==n?void 0:n.url,null==n?void 0:n.ctx,(function(e){var t=e.code;e=e.isErr,null!=r&&r({code:void 0===t?"unknown":t,isErr:e})}));if("function"==typeof(null==t?void 0:t.retCodeHandler))return a=(i=t.retCodeHandler(e,null==n?void 0:n.url,null==n?void 0:n.ctx,null==n?void 0:n.payload)||{}).code,c=i.isErr,null!=r&&r({code:void 0===a?"unknown":a,isErr:c});if(!(e="string"==typeof e?JSON.parse(e):e))return null!=r&&r({code:"unknown",isErr:!1});"function"==typeof(null==(o=null==t?void 0:t.ret)?void 0:o.join)&&(Y=[].concat(t.ret.map((function(e){return e.toLowerCase()}))));var s=Object.getOwnPropertyNames(e).filter((function(e){return-1!==Y.indexOf(e.toLowerCase())}));if(s.length)return"未知"!==(a=e[s[0]])&&""!==a||(a="unknown"),null!=r&&r({code:""+a,isErr:0!==a&&"0"!==a&&"unknown"!==a});null!=r&&r({code:"unknown",isErr:!1})}catch(e){null!=r&&r({code:"unknown",isErr:!1})}}(n.response,e.api,{url:p,ctx:n,payload:o},(function(e){var n=e.code,a=(e=e.isErr,[i?"AJAX_ERROR: request "+i:"","fetch req url: "+p,"res status: "+(c.status||0),"res duration: "+c.duration+"ms",g,m,"req method: "+(c.method||"GET"),"res retcode: "+n,Se(y,"req param"),Se(w,"res data")].filter((function(e){return e})).join("\n\n"));c.ret=n,c.isErr=+e,c.payload=o,r.publishNormalLog({msg:a,level:i?V.AJAX_ERROR:e?V.RET_ERROR:V.API_RESPONSE,code:n,trace:v},t),r.publishSpeed(c,t)}))}catch(f){c.ret="unknown",r.publishSpeed(c,t)}}else c.type="static",c.urlQuery=A(p,!0),r.publishSpeed(c,t);n.removeEventListener("abort",s),n.removeEventListener("error",u),n.removeEventListener("timeout",l)}),0))})),function(){n.failType="abort"}),u=function(){n.failType="error"},l=function(){n.failType="timeout"};n.addEventListener("abort",s),n.addEventListener("error",u),n.addEventListener("timeout",l)}};this.hackXHROptions=o,n=this.hackXHROptions,ke.find((function(e){return e.name===n.name}))||(ke.push(n),!Le&&window.XMLHttpRequest&&(Te=window.XMLHttpRequest.prototype.send,xe=window.XMLHttpRequest.prototype.open,_e=window.XMLHttpRequest.prototype.setRequestHeader,Le=!0,window.XMLHttpRequest.prototype.open=function(){this.aegisMethod=arguments[0];var e,t=arguments[1];if(Ne.test(t)&&(t=""+location.origin+t),this.aegisUrl=t,null==(t=null==(e=n.ignoreHackReg)?void 0:e.test)||!t.call(e,this.aegisUrl))if(this.aegisXhrStartTime=Date.now(),this.sendByAegis)we.isIE()||(this.timeout=5e3);else for(var r=0;r<ke.length;r++){var o=ke[r];try{"function"==typeof o.open&&o.open(this)}catch(e){}}return xe.apply(this,arguments)},window.XMLHttpRequest.prototype.setRequestHeader=function(){var e,t,r;return null!=(t=null==(r=n.ignoreHackReg)?void 0:r.test)&&t.call(r,this.aegisUrl)?_e.apply(this,arguments):(t=arguments[0],r=arguments[1],this.aegisXhrReqHeader=null!=(e=this.aegisXhrReqHeader)?e:{},-1<["traceparent","b3","sw8","sentry-trace"].indexOf(t)&&(this.aegisXhrReqHeader[t]||(arguments[1]=r),this.aegisXhrReqHeader[t])?void 0:(this.aegisXhrReqHeader[t]=arguments[1],_e.apply(this,arguments)))},window.XMLHttpRequest.prototype.send=function(){var e,t;if(!(null!=(t=null==(e=n.ignoreHackReg)?void 0:e.test)&&t.call(e,this.aegisUrl)||this.sendByAegis))for(var r=0;r<ke.length;r++){var o=ke[r];try{"function"==typeof o.send&&o.send(this,arguments[0])}catch(e){}}return Te.apply(this,arguments)}))},getPerformanceEntryByUrl:function(e,t){return null!=(e=e.api)&&e.usePerformanceTiming&&"string"==typeof t.url&&(e=null==(e=performance.getEntriesByName(t.url))?void 0:e.pop())?{url:t.url,isHttps:I(t.url),method:t.method,type:t.type,status:t.status,duration:Number(e.duration.toFixed(2)),nextHopProtocol:e.nextHopProtocol||"",domainLookup:P(e.domainLookupEnd-e.domainLookupStart),connectTime:P(e.connectEnd-e.connectStart)}:{url:t.url,isHttps:I(t.url),method:t.method,type:t.type,status:t.status,duration:Number(t.duration.toFixed(2)),nextHopProtocol:"",domainLookup:R.number,connectTime:R.number}},publishSpeed:function(e){var t=this;this.$walk((function(n){var r=t.$getConfig(n);"fetch"===e.type&&r&&"function"==typeof r.urlHandler?n.speedLogPipeline(o(o({},e),{url:A(r.urlHandler(e.url,e.payload))})):(e.url=A(e.url),n.speedLogPipeline(e))}))},publishNormalLog:function(e){this.$walk((function(t){t.normalLogPipeline(e)}))},destroy:function(){var e,t,n;this.option.publishSpeed=function(){},this.option.publishNormalLog=function(){},this.option.hackXHROptions&&(e=this.option.hackXHROptions,-1!==(n=ke.findIndex((function(t){return t.name===e.name}))))&&ke.splice(n,1),this.option.hackFetchOptions&&(t=this.option.hackFetchOptions,-1!==(n=Me.findIndex((function(e){return e.name===t.name}))))&&Me.splice(n,1),this.option.override=!1}})),He={},je=new pe({name:"reportBridgeSpeed",override:!1,onNewAegis:function(e){this.override||(this.override=!0,this.overrideBridge(e))},publishSpeed:function(e,t){this.$walk((function(n){n===t&&n.speedLogPipeline(e)}))},overrideBridge:function(e){var t=this,n=e.config;n.reportBridgeSpeed&&n.h5Bridge&&n.h5BridgeFunc.length&&n.h5BridgeFunc.forEach((function(r){var o=n.h5Bridge[r];He[r]=o,n.h5Bridge[r]=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var a=r[0],c=r[1],s=r[2],u=r[3],l=Date.now();o(a,c,s,(function(r){var o=(i=L(r,n.api)).code,i=i.isErr;o={url:a+"-"+c,name:a+"-"+c,duration:Date.now()-l,type:"bridge",ret:o,isErr:+i},t.publishSpeed(o,e),u(r)}))}}))},unHackBridge:function(e){Object.keys(He).forEach((function(t){He[t]&&(e.config.h5Bridge[t]=He[t])})),He={}},destroy:function(e){this.option.publishSpeed=function(){},this.option.unHackBridge(e),this.option.override=!1}});function qe(e,t,n,r){return void 0===n&&(n=15e3),void 0===r&&(r=0),(t=void 0===t?0:t)<=e&&e<=n?e:r}(Ye=Ae=Ae||{})[Ye.unknown=100]="unknown",Ye[Ye.wifi=1]="wifi",Ye[Ye.net2g=2]="net2g",Ye[Ye.net3g=3]="net3g",Ye[Ye.net4g=4]="net4g",Ye[Ye.net5g=5]="net5g",Ye[Ye.net6g=6]="net6g",(Ye=Ce=Ce||{})[Ye.android=1]="android",Ye[Ye.ios=2]="ios",Ye[Ye.windows=3]="windows",Ye[Ye.macos=4]="macos",Ye[Ye.linux=5]="linux",Ye[Ye.other=100]="other",(Ye=Ie=Ie||{})[Ye.unknown=100]="unknown",Ye[Ye.normal=0]="normal",Ye[Ye.weak=1]="weak",Ye[Ye.disconnected=2]="disconnected";var Be,Fe,We,Ge,Ve,Xe,Je,$e,Ke,Ye=new pe({name:"device",onNewAegis:function(e){e.extendBean("platform",this.getPlatform()),e.extendBean("netType",Ae.unknown),this.getDpi(e),this.refreshNetworkTypeToBean(e),this.refreshNetworkStatusToBean(e)},getDpi:function(e){e.extendBean("vp",Math.round(window.innerWidth)+" * "+Math.round(window.innerHeight)),window.screen&&e.extendBean("sr",Math.round(window.screen.width)+" * "+Math.round(window.screen.height))},getPlatform:function(){var e={android:/\bAndroid\s*([^;]+)/,ios:/\b(iPad|iPhone|iPod)\b.*? OS ([\d_]+)/,windows:/\b(Windows NT)/,macos:/\b(Mac OS)/,linux:/\b(Linux)/i},t=Object.keys(e).find((function(t){return e[t].test(navigator.userAgent)}));return t?Ce[t]:Ce.other},refreshNetworkTypeToBean:function(e){var t=this,n=e.config;n&&("function"==typeof n.getNetworkType?n.getNetworkType:ze)((function(n){Ae[n]||(n=Ae.unknown),e.extendBean("netType",n),t.NetworkRefreshTimer=setTimeout((function(){t.refreshNetworkTypeToBean(e),clearTimeout(t.NetworkRefreshTimer)}),1e4)}))},refreshNetworkStatusToBean:function(e){var t,n=this,r=e.config;r&&null!=(t="function"==typeof r.getNetworkStatus?r.getNetworkStatus:t)&&t((function(t){void 0===Ie[t]&&(t=Ie.unknown),e.extendBean("netStatus",t),n.NetworkStatusRefreshTimer=setTimeout((function(){n.refreshNetworkStatusToBean(e),clearTimeout(n.NetworkStatusRefreshTimer)}),1e4)}))}}),ze=function(e){var t="",n=navigator.userAgent.match(/NetType\/(\w+)/);n?t=n[1]:navigator.connection&&(t=navigator.connection.effectiveType||navigator.connection.type),e((n=t=t||"unknown",0<=(n=String(n).toLowerCase()).indexOf("4g")?Ae.net4g:0<=n.indexOf("wifi")?Ae.wifi:0<=n.indexOf("5g")?Ae.net5g:0<=n.indexOf("6g")?Ae.net6g:0<=n.indexOf("3g")?Ae.net3g:0<=n.indexOf("2g")?Ae.net2g:Ae.unknown))},Qe=window.WebSocket,Ze=[],et={construct:function(e,t){var n=new e(t[0],t[1]);return n.originSend=n.send,n.addEventListener("error",(function(e){var t=(e=(null==e?void 0:e.currentTarget)||{}).url,n=e.readyState;null!=Ze&&Ze.forEach((function(e){null!=(e=e.onErr)&&e({msg:"无法获知具体错误信息，需在浏览器控制台查看！",readyState:n,connectUrl:t})}))})),Object.defineProperty(n,"send",{get:function(){return function(e){null!=(t=n.originSend)&&t.call(n,e);var t=n.readyState,r=(e=WebSocket.OPEN,WebSocket.CLOSED),i=WebSocket.CONNECTING,a=WebSocket.CLOSING;if(t!==e){var c={readyState:t,connectUrl:n.url};switch(t){case r:Ze.forEach((function(e){null!=(e=e.sendErr)&&e(o({msg:"消息发送失败，连接已关闭！"},c))}));break;case i:Ze.forEach((function(e){(0,e.sendErr)(o({msg:"消息发送失败，正在连接中！"},c))}));break;case a:Ze.forEach((function(e){(0,e.sendErr)(o({msg:"消息发送失败，连接正在关闭！"},c))}))}}}}}),n}},tt=new pe({name:"onError"}),nt=tt=new pe({name:"onError",onNewAegis:function(e){this.startListen(e)},startListen:function(e){function t(t){(t=t&&Q(t.reason))&&l.publishErrorLog({msg:"PROMISE_ERROR: "+t,level:V.PROMISE_ERROR},e)}function n(t){var n;if(t=(null==t?void 0:t.target)||(null==t?void 0:t.srcElement)){var r=t.src||t.href||"";if(t=void 0===(t=t.tagName)?"script":t,!(N(n=r,e.config.hostUrl)||-1<window.location.href.indexOf(n))){var o={msg:t+" load fail: "+r,level:V.INFO};if(/\.js$/.test(r))o.level=V.SCRIPT_ERROR;else if(/\.css$/.test(r))o.level=V.CSS_ERROR;else switch(t.toLowerCase()){case"script":o.level=V.SCRIPT_ERROR;break;case"link":o.level=V.CSS_ERROR;break;case"img":o.level=V.IMAGE_ERROR;break;case"audio":case"video":o.level=V.MEDIA_ERROR;break;default:return}l.publishErrorLog(o,e)}}}var r,o,a,u,l=this,f=window.onerror;window.onerror=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r,o=Q(t[0]);"string"!=typeof(r=o)||!r||s.some((function(e){return-1<r.indexOf(e)}))||c.some((function(e){return-1<r.indexOf(e)}))||l.publishErrorLog({msg:(o||"")+" @ ("+(Q(t[1])||"")+":"+(t[2]||0)+":"+(t[3]||0)+")\n          \n"+Q(t[4]||""),level:V.ERROR},e),null!=f&&f.call.apply(f,i([window],t))},window.addEventListener("unhandledrejection",t),window.document.addEventListener("error",n,!0),e.lifeCycle.on("destroy",(function(){0===tt.countInstance()&&(window.document.removeEventListener("unhandledrejection",t),window.document.removeEventListener("error",n,!0))})),e.config.websocketHack&&(r={key:e.config.id+"-"+this.name,onErr:function(t){var n;null!=(n=l.publishWsErrorLog)&&n.call(l,t,e)},sendErr:function(t){var n;null!=(n=l.publishWsErrorLog)&&n.call(l,t,e)}},this.hackWebsocketConfig=r,r=this.hackWebsocketConfig,window.Proxy)&&window.WebSocket&&(o=window.WebSocket,window&&!o.isHack&&(a=new Proxy(WebSocket,et),o.isHack=!0,window.WebSocket=a),u=r,Ze.find((function(e){return e.key===u.key}))||u&&Ze.push(u))},publishErrorLog:function(e,t){this.$walk((function(n){n===t&&n.normalLogPipeline(e)}))},publishWsErrorLog:function(e,t){var n=e.connectUrl,r=e.msg;e=e.readyState,this.publishErrorLog({msg:"WEBSOCKET_ERROR: \n              connect: "+n+"\n              readyState: "+e+"\n              msg: "+r,level:V.WEBSOCKET_ERROR},t)},destroy:function(){var e,t;this.option.publishErrorLog=function(){},this.option.hackWebsocketConfig&&(e=this.option.hackWebsocketConfig,window.WebSocket=Qe,-1!==(t=Ze.findIndex((function(t){return t.key===e.key}))))&&Ze.splice(t,1)}}),rt=(new pe({name:"pagePerformance"}),3),ot=new pe({name:"pagePerformance",performanceMap:{},onNewAegis:function(e){F()&&(Be?this.publish(Be,e):this.startCalcPerformance(e))},publish:function(e,t){var n=this;this.$walk((function(r){r===t&&r.sendPipeline([function(e,t){var o,i=[];for(o in e)i.push(o+"="+e[o]);var a,c=n.$getConfig(r);if(c)return a=-1===(null==(a=r.config.performanceUrl)?void 0:a.indexOf("?"))?"?":"&","function"==typeof c.urlHandler?t({url:r.config.performanceUrl+a+i.join("&")+"&from="+(encodeURIComponent(c.urlHandler())||window.location.href),beanFilter:["from"],type:X.PERFORMANCE,log:e}):t({url:r.config.performanceUrl+a+i.join("&"),type:X.PERFORMANCE,log:e})}],X.PERFORMANCE)(o({},e))}))},startCalcPerformance:function(e){var t=this;try{this.getFirstScreenTiming(e,(function(n){var r=performance.timing;r&&(Be={dnsLookup:qe(r.domainLookupEnd-r.domainLookupStart),tcp:qe(r.connectEnd-r.connectStart),ssl:qe(0===r.secureConnectionStart?0:r.requestStart-r.secureConnectionStart),ttfb:qe(r.responseStart-r.requestStart),contentDownload:qe(r.responseEnd-r.responseStart),domParse:qe(r.domInteractive-r.domLoading,0,15e3,1070),resourceDownload:qe(r.loadEventStart-r.domInteractive,0,15e3,1070),firstScreenTiming:qe(Math.floor(n),0,15e3,15e3)},(r=e.config).extraPerformanceData&&"{}"!==JSON.stringify(r.extraPerformanceData)&&(r=(n=r.extraPerformanceData).engineInit,n=n.bundleLoad,Be=o(o({},Be),{engineInit:qe(r,0,1e4),bundleLoad:qe(n,0,1e4)})),t.publish(Be,e))}))}catch(e){}},getFirstScreenTiming:function(e,t){var n=this;e.lifeCycle.on("destroy",(function(){f&&clearTimeout(f)}));var r,o=this,i=["script","style","link","br"],a=[],c={},s=(-1<(null==(u=null==(u=window.PerformanceObserver)?void 0:u.supportedEntryTypes)?void 0:u.indexOf("paint"))&&(r=new PerformanceObserver((function(o){o.getEntries().forEach((function(o){var i;"paint"===o.entryType&&"first-contentful-paint"===o.name&&0<(i=document.querySelectorAll("[AEGIS-FIRST-SCREEN-TIMING]")).length&&(n.setFirstScreenInfo(e,o.startTime,i[0],i),null!=t&&t(o.startTime),s.disconnect(),r.disconnect())}))}))).observe({entryTypes:["paint"]}),new MutationObserver((function(e){var t={roots:[],ignores:[],rootsDomNum:[],time:performance.now()};e.forEach((function(e){e&&e.addedNodes&&Array.prototype.slice.call(e.addedNodes).forEach((function(e){o.isEleInArray(e,t.ignores)?t.ignores.push(e):1===e.nodeType&&e.hasAttribute("AEGIS-FIRST-SCREEN-TIMING")?(Object.prototype.hasOwnProperty.apply(c,[t.time])||(c[t.time]=[]),c[t.time].push(e)):1===e.nodeType&&(o.hasAncestorOrSelfWithAttribute(e,"AEGIS-IGNORE-FIRST-SCREEN-TIMING")?t.ignores.push(e):-1!==i.indexOf(e.nodeName.toLocaleLowerCase())||o.isEleInArray(e,t.roots)||(t.roots.push(e),t.rootsDomNum.push(o.walkAndCount(e)||0)))}))})),t.roots.length&&a.push(t)})));s.observe(document,{childList:!0,subtree:!0});var u,l=function(i){(i=void 0===i?0:i)||(u=0,(p=Object.keys(c)).length?(i=Math.max.apply(null,p),n.setFirstScreenInfo(e,i,null==(p=c[i])?void 0:p[0],c)):a.forEach((function(t){for(var r=0;r<t.roots.length;r++)t.rootsDomNum[r]>u&&o.isInFirstScreen(t.roots[r])&&(u=t.rootsDomNum[r],i=t.time,n.setFirstScreenInfo(e,i,t.roots[r]))})),a.length=0,Object.keys(c).forEach((function(e){c[e]=c[e].map((function(e){var t={tagName:e.tagName},n=e.attributes;if(!n)return e;for(var r=0;r<n.length;r++){var o=n[r];o.name&&(t[o.name]=e.getAttribute(o.name))}return t}))})));var u,d=(p=performance.timing).domInteractive-p.domLoading,p=p.loadEventStart-p.domInteractive,g=i;f=null;for(var h=0,m=[d,p,g];h<m.length;h++)if(m[h]<=0&&0<rt){f=setTimeout((function(){return l(g)}),3e3);break}f?--rt:(s.disconnect(),null!=r&&r.disconnect(),null!=t&&t(i))},f=setTimeout((function(){return l()}),3e3)},setFirstScreenInfo:function(e,t,n,r){var o;e.config.id&&this.performanceMap[e.config.id]||(e.config.id&&(this.performanceMap[e.config.id]=!0),("object"!=typeof(null==(o=e.config)?void 0:o.pagePerformance)||null!=(o=e.config.pagePerformance)&&o.firstScreenInfo)&&(e.firstScreenInfo={element:n,timing:t,markDoms:r}))},isEleInArray:function(e,t){return!(!e||e===document.documentElement)&&(-1!==t.indexOf(e)||this.isEleInArray(e.parentElement,t))},isInFirstScreen:function(e){var t,n;return!(!e||"function"!=typeof e.getBoundingClientRect)&&(e=e.getBoundingClientRect(),t=window.innerHeight,n=window.innerWidth,0<=e.left)&&e.left<n&&0<=e.top&&e.top<t&&0<e.width&&0<e.height},walkAndCount:function(e){var t=0;if(e&&1===e.nodeType){t+=1;var n=e.children;if(null!=n&&n.length)for(var r=0;r<n.length;r++)1===n[r].nodeType&&n[r].hasAttribute("AEGIS-IGNORE-FIRST-SCREEN-TIMING")||(t+=this.walkAndCount(n[r]))}return t},hasAncestorOrSelfWithAttribute:function(e,t){for(var n=e;n&&n!==document.body;){if(n.hasAttribute(t))return!0;n=n.parentElement}return!1}});function it(){Ve=[],We=-1,Fe=null,st(addEventListener)}function at(e,t){Fe||(Fe=t,We=e,Ge=new Date,st(removeEventListener),ct())}function ct(){var e;0<=We&&We<Ge-Je&&(e={entryType:"first-input",name:Fe.type,target:Fe.target,cancelable:Fe.cancelable,startTime:Fe.timeStamp,processingStart:Fe.timeStamp+We},Ve.forEach((function(t){t(e)})),Ve=[])}function st(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,$e,Xe)}))}function ut(e,t){var n=Ct(),r="navigate";return 0<=Pt?r="back-forward-cache":n&&(document.prerendering||0<It()?r="prerender":document.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-"))),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}}function lt(e,t,n){try{var r;if(PerformanceObserver.supportedEntryTypes.includes(e))return(r=new PerformanceObserver((function(e){Promise.resolve().then((function(){t(e.getEntries())}))}))).observe(Object.assign({type:e,buffered:!0},n||{})),r}catch(e){}}function ft(e,t,n,r){var o,i;return function(a){0<=t.value&&(a||r)&&((i=t.value-(o||0))||void 0===o)&&(o=t.value,t.delta=i,t.rating=(a=t.value)>n[1]?"poor":a>n[0]?"needs-improvement":"good",e(t))}}function dt(e){requestAnimationFrame((function(){return requestAnimationFrame((function(){return e()}))}))}function pt(e){function t(t){"pagehide"!==t.type&&"hidden"!==document.visibilityState||e(t)}addEventListener("visibilitychange",t,!0),addEventListener("pagehide",t,!0)}function gt(e){var t=!1;return function(n){t||(e(n),t=!0)}}function ht(){return Lt<0&&(Lt=kt(),Ut(),At((function(){setTimeout((function(){Lt=kt(),Ut()}),0)}))),{get firstHiddenTime(){return Lt}}}function mt(e){document.prerendering?addEventListener("prerenderingchange",(function(){return e()}),!0):e()}function vt(e,t){t=t||{},mt((function(){var n,r=ht(),o=ut("FCP"),i=lt("paint",(function(e){e.forEach((function(e){"first-contentful-paint"===e.name&&(i.disconnect(),e.startTime<r.firstHiddenTime)&&(o.value=Math.max(e.startTime-It(),0),o.entries.push(e),n(!0))}))}));i&&(n=ft(e,o,Mt,t.reportAllChanges),At((function(r){o=ut("FCP"),n=ft(e,o,Mt,t.reportAllChanges),dt((function(){o.value=performance.now()-r.timeStamp,n(!0)}))})))}))}function yt(){var e;0<=Ot&&Ot<St-jt&&(e={entryType:"first-input",name:bt.type,target:bt.target,cancelable:bt.cancelable,startTime:bt.timeStamp,processingStart:bt.timeStamp+Ot},Tt.forEach((function(t){t(e)})),Tt=[])}function wt(e){var t,n,r,o;function i(){qt(n,r),o()}function a(){o()}e.cancelable&&(t=(1e12<e.timeStamp?new Date:performance.now())-e.timeStamp,"pointerdown"==e.type?(n=t,r=e,o=function(){removeEventListener("pointerup",i,Ht),removeEventListener("pointercancel",a,Ht)},addEventListener("pointerup",i,Ht),addEventListener("pointercancel",a,Ht)):qt(t,e))}function Et(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,wt,Ht)}))}function Rt(e){var t=e.name;0<(e=e.value)&&(Gt[t]=e)}Xe={passive:!0,capture:!0},Je=new Date,$e=function(e){var t,n,r,o;function i(){at(n,r),o()}function a(){o()}e.cancelable&&(t=(1e12<e.timeStamp?new Date:performance.now())-e.timeStamp,"pointerdown"==e.type?(n=t,r=e,o=function(){removeEventListener("pointerup",i,Xe),removeEventListener("pointercancel",a,Xe)},addEventListener("pointerup",i,Xe),addEventListener("pointercancel",a,Xe)):at(t,e))},Ke="hidden"===document.visibilityState?0:1/0,addEventListener("visibilitychange",(function e(t){"hidden"===document.visibilityState&&(Ke=t.timeStamp,removeEventListener("visibilitychange",e,!0))}),!0),it(),self.webVitals={firstInputPolyfill:function(e){Ve.push(e),ct()},resetFirstInputPolyfill:it,get firstHiddenTime(){return Ke}};var bt,Ot,St,Tt,xt,_t,Pt=-1,At=function(e){addEventListener("pageshow",(function(t){t.persisted&&(Pt=t.timeStamp,e(t))}),!0)},Ct=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},It=function(){var e=Ct();return e&&e.activationStart||0},Lt=-1,kt=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},Nt=function(e){"hidden"===document.visibilityState&&-1<Lt&&(Lt="visibilitychange"===e.type?e.timeStamp:0,removeEventListener("visibilitychange",Nt,!0),removeEventListener("prerenderingchange",Nt,!0))},Ut=function(){addEventListener("visibilitychange",Nt,!0),addEventListener("prerenderingchange",Nt,!0)},Mt=[1800,3e3],Dt=[.1,.25],Ht={passive:!0,capture:!0},jt=new Date,qt=function(e,t){bt||(bt=t,Ot=e,St=new Date,Et(removeEventListener),yt())},Bt=[100,300],Ft=[2500,4e3],Wt={},Gt=(new pe({name:"webVitals"}),{FCP:-1,LCP:-1,FID:-1,CLS:-1}),Vt=new pe({name:"webVitals",onNewAegis:function(e){if(F()&&"function"==typeof window.PerformanceObserver&&"function"==typeof performance.getEntriesByName)try{vt(Rt),i=Rt,a={},mt((function(){function e(e){(e=e[e.length-1])&&e.startTime<r.firstHiddenTime&&(o.value=Math.max(e.startTime-It(),0),o.entries=[e],t())}var t,n,r=ht(),o=ut("LCP"),c=lt("largest-contentful-paint",e);c&&(t=ft(i,o,Ft,a.reportAllChanges),n=gt((function(){Wt[o.id]||(e(c.takeRecords()),c.disconnect(),Wt[o.id]=!0,t(!0))})),["keydown","click"].forEach((function(e){addEventListener(e,n,!0)})),pt(n),At((function(e){o=ut("LCP"),t=ft(i,o,Ft,a.reportAllChanges),dt((function(){o.value=performance.now()-e.timeStamp,Wt[o.id]=!0,t(!0)}))})))})),r=Rt,o={},mt((function(){function e(e){e.startTime<n.firstHiddenTime&&(i.value=e.processingStart-e.startTime,i.entries.push(e),c(!0))}function t(t){t.forEach(e)}var n=ht(),i=ut("FID"),a=lt("first-input",t),c=ft(r,i,Bt,o.reportAllChanges);a&&pt(gt((function(){t(a.takeRecords()),a.disconnect()}))),a&&At((function(){i=ut("FID"),c=ft(r,i,Bt,o.reportAllChanges),Tt=[],Ot=-1,bt=null,Et(addEventListener),Tt.push(e),yt()}))})),t=Rt,n={},vt(gt((function(){function e(e){e.forEach((function(e){var t,n;e.hadRecentInput||(t=a[0],n=a[a.length-1],i&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(i+=e.value,a.push(e)):(i=e.value,a=[e]))})),i>o.value&&(o.value=i,o.entries=a,r())}var r,o=ut("CLS",0),i=0,a=[],c=lt("layout-shift",e);c&&(r=ft(t,o,Dt,n.reportAllChanges),pt((function(){e(c.takeRecords()),r(!0)})),At((function(){o=ut("CLS",i=0),r=ft(t,o,Dt,n.reportAllChanges),dt((function(){return r()}))})),setTimeout(r,0))}))),W(this.publish.bind(this,e),{once:!0,delay:{visibilitychange:10}})}catch(e){}var t,n,r,o,i,a},publish:function(e){this.$walk((function(t){var n;t===e&&null!=(n=t.sendPipeline)&&n.call(t,[function(e,n){var r,o=[];for(r in e)o.push(r+"="+e[r]);var i=-1===(null==(i=null==(i=t.config)?void 0:i.performanceUrl)?void 0:i.indexOf("?"))?"?":"&";n({url:t.config.webVitalsUrl+i+o.join("&"),type:X.VITALS,log:e,sendBeacon:!0})}],X.VITALS)(o({},Gt))}))},destroy:function(){this.option.publish=function(){}}}),Xt=(new pe({name:"spa"}),["replaceState","pushState","popstate","hashchange"]),Jt=new pe({name:"spa",originFireUrl:"",onNewAegis:function(e){var t=this;history.pushState=this.wr("pushState")||history.pushState,history.replaceState=this.wr("replaceState")||history.replaceState,this.sendPv=this.sendPv.bind(this),e.config.spa&&this.sendPv(e),Xt.forEach((function(n){return window.addEventListener(n,(function(){return t.sendPv.call(t,e)}))}))},wr:function(e){var t=history[e],n="__"+e+"__hasWrittenByTamSpa";return"function"==typeof t&&!history[n]&&(Object.defineProperty(history,n,{value:!0,enumerable:!1}),function(){var n=t.apply(this,arguments),r=null;return"function"==typeof Event?r=new Event(e):(r=document.createEvent("HTMLEvents")).initEvent(e,!1,!0),window.dispatchEvent(r),n})},sendPv:function(e){var t=this;setTimeout((function(){var n=location.pathname+location.hash+e.config.id;t.$walk((function(r){var o;r===e&&(o=r.config.pvUrl)&&n&&n!==t.originFireUrl&&(r.sendPipeline([function(e,t){t({url:""+o,type:X.PV})}],X.PV)(null),t.originFireUrl=n)}))}),0)},destroy:function(){this.option.sendPv=function(){}}});function $t(e){var t,n,r,i,a=xt.call(this,e)||this;a.sendNow=!1,a.isReportReady=!1,a.reportRequestQueue=[],a.speedLogPipeline=q([U(a),(i=a.config,function(e,t){var n,r,o,a="number"==typeof i.repeat?i.repeat:60;!i.speedSample||a<=0?t(e):(n=(null==i?void 0:i.id)||"0",r=ce[n]||{},Array.isArray(e)?(o=e.filter((function(e){var t=!r[e.url]||r[e.url]<a;return t?(r[e.url]=1+~~r[e.url],ce[n]=r):ae[n]||se(n),t}))).length&&t(o):!r[e.url]||r[e.url]<a?(r[e.url]=1+~~r[e.url],ce[n]=r,t(e)):ae[n]||se(n))}),(r=a,function(e,t){ze((function(n){r.extendBean("netType",n),t(e)}))}),function(e,t){null!=(n=a.lifeCycle)&&n.emit("beforeReportSpeed",e);var n,r=a.config.beforeReportSpeed;if((e="function"==typeof r?e.filter((function(e){return!1!==r(e)})):e).length)return t(e)},function(e,t){t(e.map((function(e){return void 0!==e.payload&&delete e.payload,e})))},function(e){return a.sendPipeline([function(e,t){var n,r,i,c;t({type:X.SPEED,url:""+a.config.speedUrl,method:"post",data:(t=e,n=o(o({},a.bean),{from:a.getCurrentPageUrl()}),i={fetch:[],static:[],bridge:[]},c=new FormData,Array.isArray(t)?t.forEach((function(e){var t=he(e);i[e.type].push(t)})):(r=he(t),i[t.type].push(r)),c.append("payload",Z(o({duration:i},n))),c),log:e})}],X.SPEED)(e)}]),e.asyncPlugin=!0;try{"undefined"!=typeof document&&(e.uin=e.uin||(null!=(t=document.cookie.match(/\buin=\D+(\d*)/))?t:[])[1]||(null!=(n=document.cookie.match(/\bilive_uin=\D*(\d+)/))?n:[])[1]||""),a.init(e),a.extendBean("sessionId",$t.sessionID),a.extendBean("from",a.getCurrentPageUrl()),"undefined"!=typeof document&&a.extendBean("referer",encodeURIComponent(document.referrer||"")),e.ext1&&a.extendBean("ext1",encodeURIComponent(e.ext1)),e.ext2&&a.extendBean("ext2",encodeURIComponent(e.ext2)),e.ext3&&a.extendBean("ext3",encodeURIComponent(e.ext3))}catch(e){console.warn(e),console.log("%cThe above error occurred in the process of initializing Aegis, which will affect your normal use of Aegis.\nIt is recommended that you contact us for feedback and thank you for your support.","color: red"),a.sendSDKError(e)}return a}function Kt(){this.constructor=_t}r(_t=$t,de=xt=de),_t.prototype=null===de?Object.create(de):(Kt.prototype=de.prototype,new Kt),$t.prototype.getBean=function(e){var t=this;return void 0===e&&(e=[]),""+Object.getOwnPropertyNames(this.bean).filter((function(t){return-1===e.indexOf(t)})).map((function(e){return"from"===e?"from="+t.getCurrentPageUrl():e+"="+t.bean[e]})).join("&")},$t.prototype.getCurrentPageUrl=function(){var e=this.config.pageUrl||location.href;return e=(e="function"==typeof this.config.urlHandler?this.config.urlHandler()||location.href:e).slice(0,2048),encodeURIComponent(e)},$t.prototype.ready=function(){function e(){var n,r,o,i;t.reportRequestQueue.length&&(n=t.reportRequestQueue.splice(0,1)[0],r=n.options,o=n.success,i=n.fail,t.$request(r,(function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return null==o?void 0:o.apply(r,t)}finally{e()}}),(function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return null==i?void 0:i.apply(r,t)}finally{e()}})))}var t=this;e(),this.isReportReady=!0},$t.prototype.request=function(e,t,n){this.config.reportImmediately||this.isReportReady?this.$request(e,t,n):this.reportRequestQueue.push({options:e,success:t,fail:n})},$t.prototype.$request=function(e,t,n){var r,i,a,c;if(e&&"string"==typeof e.url&&""!==e.url&&this.bean.id)return c=e.url,!1!==e.addBean&&(c=function(t,n){var r,o,i,a=t,c=e.beanFilter||[];for(r in n)-1===c.indexOf(r)&&((i=(o=new RegExp("([?&])"+r+"(=([^&]*))?(?=&|$)")).exec(a))?i[2]&&""!==i[3]&&"undefined"!==i[3]||(a=a.replace(o,"$1"+r+"="+n[r])):(i=-1<a.indexOf("?")?"&":"?",a+=i+r+"="+n[r]));return a}(c,o(o({},this.bean),{from:this.getCurrentPageUrl()}))),e.url=c,c=e.method||"get",i=this.config.onBeforeRequest,(e=i?i(e,this):e)?e.url?void((null!=e&&e.sendBeacon||this.sendNow)&&"function"==typeof(null===navigator||void 0===navigator?void 0:navigator.sendBeacon)?navigator.sendBeacon(e.url,e.data):((r=new XMLHttpRequest).sendByAegis=!0,r.addEventListener("readystatechange",(function(){4===r.readyState&&(400<=r.status||0===r.status?null!=n&&n(r.response):null!=t&&t(r.response))})),"get"===c.toLocaleLowerCase()?(r.open("get",(i=e.url,a=e.data,"string"!=typeof i?"":"object"==typeof a&&a?(c=Object.getOwnPropertyNames(a).map((function(e){var t=a[e];return e+"="+("string"==typeof t?encodeURIComponent(t):encodeURIComponent(JSON.stringify(t)))})).join("&").replace(/eval/gi,"evaI"),i+(-1===i.indexOf("?")?"?":"&")+c):i)),r.send()):(r.open("post",e.url),e.contentType&&r.setRequestHeader("Content-Type",e.contentType),"string"==typeof e.data&&(e.data=e.data.replace(/eval/gi,"evaI")),r.send(e.data)))):console.warn("Please handle the parameters reasonably, options.url is necessary"):console.warn("Sending request blocked")},$t.prototype.publishPluginsLogs=function(){var e=$t.installedPlugins.find((function(e){return"reportAssetSpeed"===e.name}));null!=e&&e.option.collectNotReportedLog(this)},$t.prototype.uploadLogs=function(e,t){var n;void 0===e&&(e={}),void 0===t&&(t={}),null!=(n=this.lifeCycle)&&n.emit("uploadLogs",e,t)},$t.sessionID="session-"+Date.now(),de=$t,new pe({name:"ie"}),new pe({name:"onClose"});var Yt=new pe({name:"onClose",onNewAegis:function(e){var t,n=this;we.desktop()?(t=window.onunload,window.onunload=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];n.publishNotReportedLog(e),null!=t&&t.call.apply(t,i([window],r))}):W(this.publishNotReportedLog.bind(this,e),{once:!0})},publishNotReportedLog:function(e){var t=this;this.$walk((function(n){n===e&&(n.sendNow=!0,n.publishPluginsLogs(),t.publishThrottlePipeLogs(n))}))},publishThrottlePipeLogs:function(e){null!=e&&e.speedLogPipeline([]),null!=e&&e.eventPipeline([]),null!=e&&e.customTimePipeline([]),null!=e&&e.normalLogPipeline([])}});return new pe({name:"aid"}),de.use(nt),de.use(De),de.use(ve),de.use(ot),de.use(Vt),de.use(ge),de.use(Ye),de.use(Jt),de.use(Yt),de.use(je),de}();var n,r,o,i,a=t.exports,c="__PRELOAD_KEY__",s="__fmp_record__",u="__form_prefetch__";!function(e){e.RUM_SDK="RUM_SDK",e.TAGNAME="TAGNAME",e.B_APP_ID="__app_id",e.C_APP_ID="APPID",e.B_USER_ID="__user_id",e.C_USER_ID="USERID",e.AEGIS_ID="__aegis_id",e.PAGE_JS="__page_js_data",e.WX="wx",e.VUE="Vue",e.WEB_AEGIS="WebAegis",e.CDN_PUBLIC_PATH="__cdn_url_prefix"}(n||(n={})),function(e){e.ERROR="ERROR",e.CUSTOM="CUSTOM",e.DEFAULT="DEFAULT",e.PROMISE_ERROR="PROMISE_ERROR",e.AJAX_ERROR="AJAX_ERROR",e.SCRIPT_ERROR="SCRIPT_ERROR",e.IMAGE_ERROR="IMAGE_ERROR",e.CSS_ERROR="CSS_ERROR",e.MEDIA_ERROR="MEDIA_ERROR",e.RET_ERROR="RET_ERROR",e.WEBSOCKET_ERROR="WEBSOCKET_ERROR"}(r||(r={})),function(e){e.LOCAL="local",e.TEST="test",e.PRO="production",e.DEV="develop",e.PRE="pre"}(o||(o={})),function(e){e.WHITE_SCREEN="PageWhiteScreen",e.SENSE_MESSAGE_Frequently="SenseMessageFrequently"}(i||(i={}));var l=1,f=3,d="admin.xiaoe-tech.com",p="init",g="domReady",h="pageLoad",m="destroy",v="jsError",y="scriptLoadError",w="imageLoadError",E="cssLoadError",R="ajaxError",b="promiseError",O="custom",S="performance",T="pv",x="vitals",_="speed",P="https://logreport.xiaoeknow.com/skynet",A=["script error","ResizeObserver loop limit exceeded","/theme/default/layer.css","/css/modules/laydate/default/laydate.css","/css/modules/code.css","chrome-extension"],C={exports:{}};!function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(C);var I=e(C.exports),L={exports:{}};!function(e){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports}(L);var k=e(L.exports);function N(){return window[n.B_APP_ID]||window[n.C_APP_ID]}function U(){return window[n.B_USER_ID]||window[n.C_USER_ID]}function M(){return window[n.TAGNAME]}function D(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)>-1)return o.LOCAL;var e=M();if(e){if(e.indexOf(".t")>-1)return o.TEST;if(e.indexOf(".r")>-1)return o.PRE;if(e.indexOf("/")>-1)return o.DEV}return o.PRO}function H(){return window.location.host===d}function j(e){return e.logs.msg.split("\n").map((function(e){return e.trim()})).filter((function(e){return e})).reduce((function(e,t){var n=t.indexOf(":"),r=t.slice(0,n).trim(),o=t.slice(n+1).trim();return e[r]=o,e}),{})}var q="";function B(){try{return q||(q=function(e){var t=null,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return document.cookie&&(t=document.cookie.match(n))?unescape(t[2]):""}("management_version")),q}catch(e){return console.log(e),q}}var F={exports:{}},W={exports:{}};!function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports}(W);var G={exports:{}};!function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}},e.exports.__esModule=!0,e.exports.default=e.exports}(G);var V={exports:{}},X={exports:{}};!function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports}(X),function(e){var t=X.exports;e.exports=function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports}(V);var J={exports:{}};!function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports}(J),function(e){var t=W.exports,n=G.exports,r=V.exports,o=J.exports;e.exports=function(e,i){return t(e)||n(e,i)||r(e,i)||o()},e.exports.__esModule=!0,e.exports.default=e.exports}(F);var $=e(F.exports);function K(e){return(e.match(/([^?=&]+)(=([^&]*))/g)||[]).reduce((function(e,t){var n=t.indexOf("=");return e[t.slice(0,n)]=t.slice(n+1),e}),{})}var Y=function(e){var t=/(([^:]+:)\/\/(([^:\/\?#]+)(:\d+)?))(\/[^?#]*)?(\?[^#]*)?(#.*)?/.exec(e)||[],n=$(t,9),r=n[0],o=n[1],i=n[2],a=n[3],c=n[4],s=n[5],u=n[6],l=n[7];return{hash:n[8]||"",search:l||"",pathname:u||"",port:s||"",hostname:c||"",host:a||"",protocol:i.replace(":","")||"",origin:o||"",href:r||"",searchParams:K(l),path:u+l||""}},z=function(e){if(window.URL)try{return function(e){var t=new window.URL(e),n=t.hostname,r=t.port,o=t.host,i=t.pathname,a=t.search,c=t.hash,s=t.protocol;return{href:e,hostname:n,port:r,host:o,pathname:i,search:a,path:i+a,hash:c,origin:t.origin,protocol:s.replace(":",""),searchParams:K(a)}}(e)}catch(t){return Y(e)}return Y(e)};function Q(e){return"function"==typeof e}function Z(e){return"string"==typeof e}var ee=function(e){return!e};function te(e){switch(Object.prototype.toString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMError]":case"[object DOMException]":return!0;default:return ne(e,Error)}}function ne(e,t){try{return e instanceof t}catch(e){return!1}}function re(e){return!e||(e=e.toLowerCase(),!!A.filter((function(t){return e.indexOf(t.toLowerCase())>-1})).length||A.indexOf(e)>-1)}function oe(){var e=arguments.length<=0?void 0:arguments[0];if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=1;t<arguments.length;t++){var n=t<0||arguments.length<=t?void 0:arguments[t];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}function ie(e){try{return Z(e)?e:JSON.stringify(e)}catch(e){return"[FAILED_TO_STRINGIFY]:"+String(e)}}function ae(){return window.performance&&window.performance.navigation?window.performance.navigation.type:-1}function ce(e,t){var n,r,o="",i=t||5;try{return n=function(e,t){for(var n="",r=0;r<t;r++)n+=" ";o+="".concat(n).concat(function(e){var t,n,r,o,i,a=e,c=[];if(!a||!a.tagName)return"";if(c.push(a.tagName.toLowerCase()),a.id&&c.push("#".concat(a.id)),(t=a.className)&&Z(t))for(n=t.split(/\s+/),i=0;i<n.length;i++)c.push(".".concat(n[i]));var s=["type","name","title","alt"];for(i=0;i<s.length;i++)r=s[i],(o=a.getAttribute(r))&&c.push("[".concat(r,'="').concat(o,'"]'));return c.join("")}(e),"\n")},r=function(e,t){if(e&&!(t>i)&&!(o.length>480)&&(n(e,t),e.children))for(var a=0;a<e.children.length;a++)r(e.children[a],t+1)},r(e,0),console.log(o),o}catch(e){return"<unknown>"}}window[s]=[];var se=Number.MAX_VALUE;var ue=/\.ts$|\.m3u8$/,le=/^http:|^https:/,fe="https://learnreport.xiaoeknow.com/v1/learnRecord/pushData",de=k(k(k(k(k(k({},a.logType.ERROR,v),a.logType.SCRIPT_ERROR,y),a.logType.IMAGE_ERROR,w),a.logType.CSS_ERROR,E),a.logType.AJAX_ERROR,R),a.logType.PROMISE_ERROR,b),pe=k(k(k(k(k({},S,S),T,T),x,x),_,_),"event",O);function ge(e,t){var n=e.logs,r=e.logType,o=t.config.filterRetError;return("log"!==r||!o||n.level!==a.logType.RET_ERROR)&&e}function he(e){var t=e.logs;return("log"!==e.logType||t.level!==a.logType.ERROR||!re(t.msg))&&e}function me(e,t){var n=e.logs,r=e.logType,o=t.config.filterImgLoadError;return("log"!==r||!o||n.level!==a.logType.IMAGE_ERROR)&&e}function ve(e,t){var n=e.logs,r=e.logType,o=t.config.filterAjaxStatusError;if("log"===r&&n&&n.level===a.logType.AJAX_ERROR){var i=j(e),c=i["fetch req url"],s=i["res status"];if(o&&"0"==s)return!1;if(le.test(c)){var u=z(c).pathname;if(ue.test(u))return!1}if(c.indexOf(P)>-1)return!1}return e}function ye(e){var t=e.logs;if("speed"===e.logType){var r=t.url,o=t.type,i=t.duration;if("static"===o){if(!i)return!1;if(-1===r.indexOf(window[n.CDN_PUBLIC_PATH])&&-1===r.indexOf("https://static-resource-cos-1252524126.cdn.xiaoeknow.com")&&-1===r.indexOf("https://assets-micro-hw.cdn.xiaoeknow.com"))return!1}if(le.test(t.url)){var a=z(r).pathname;if(ue.test(a))return!1;if(r===fe)return!1;if(r===P)return!1}}return e}function we(e,t){var n=t.config.externalFilter;return(!Q(n)||!ee(n(e)))&&e}function Ee(e){return((t=D())===o.PRO||t===o.PRE)&&e;var t}function Re(e){var t=e.logs;return("log"!==e.logType||t.level!==a.logType.CSS_ERROR||!re(t.msg))&&e}function be(e){var t=e.logs;if("performance"===e.logType&&t&&t.resourceDownload){if(document.prerendering)return!1;var n=function(){for(var e=0;e<window[s].length;e++){var t=window[s][e],n=t.source,r=t.time;if(n>=se)return r}return 0}();n&&(t.firstScreenTiming=n)}return e}var Oe=function(e,t){return{map:function(n){return ee(t)?Oe(e,!1):Oe(e,n(t,e))},valueOf:function(){return t}}};function Se(){var e="",t=N();return t&&(e=t),{uin:e}}function Te(){var e=M();return{env:k(k(k(k(k({},o.LOCAL,a.environment.local),o.DEV,a.environment.local),o.TEST,a.environment.test),o.PRE,a.environment.pre),o.PRO,a.environment.production)[D()],version:e}}function xe(e,t){return{beforeRequest:function(n){try{return function(e,t){var n=pe[e.logType];if(n)t.emit(n,e);else if(e.logs){var r=e.logs.level,o=de[r];o&&t.emit(o,e)}}(oe({},n,{id:t}),e),Oe(e,n).map(he).map(ge).map(ye).map(ve).map(me).map(we).map(Re).map(Ee).map(be).valueOf()}catch(e){return console.log(e),n}}}}function _e(e){var t=window[n.AEGIS_ID];return oe({id:t,reportApiSpeed:!0,reportAssetSpeed:!0,pagePerformance:!0,webVitals:!0,onError:!0,aid:!0,random:l,spa:!0,delay:1e3,repeat:f,websocketHack:!1,offlineLog:!1,offlineLogExp:3,speedSample:!0,whiteListUrl:""},oe(Se(),Te()),xe(e,t))}var Pe,Ae,Ce,Ie="0.1.26",Le=k(k(k(k(k(k(k(k(k(k({},r.DEFAULT,a.logType.REPORT),r.ERROR,a.logType.ERROR),r.PROMISE_ERROR,a.logType.PROMISE_ERROR),r.AJAX_ERROR,a.logType.AJAX_ERROR),r.SCRIPT_ERROR,a.logType.SCRIPT_ERROR),r.IMAGE_ERROR,a.logType.IMAGE_ERROR),r.CSS_ERROR,a.logType.CSS_ERROR),r.MEDIA_ERROR,a.logType.MEDIA_ERROR),r.RET_ERROR,a.logType.RET_ERROR),r.WEBSOCKET_ERROR,a.logType.WEBSOCKET_ERROR),ke=(k(k(k(k(k(k(k(k(k(k(Pe={},p,[]),g,[]),m,[]),v,[]),y,[]),w,[]),E,[]),R,[]),b,[]),O,[]),k(k(k(k(k(Pe,S,[]),x,[]),T,[]),_,[]),h,[])),Ne=[],Ue={};function Me(){return Ce||(console.log("%c WebAegis %c v".concat(Ie," "),"background:#35495e ; padding: 1px; border-radius: 3px 0 0 3px;  color: #fff","background:#007ec6 ; padding: 1px; border-radius: 0 3px 3px 0;  color: #fff"),(Ce={on:function(e,t){var n=ke[e];-1===n.indexOf(t)&&n.push(t)},off:function(e,t){console.log(e,t)},emit:function(e,t){ke[e].forEach((function(n){try{n(t)}catch(t){Ce.report(r.ERROR,{msg:"Error: ".concat(t.toString(),"\nStack: ").concat(t.stack,"\nHook: ").concat(e)})}}))},report:function(e,t){try{if(console.log("【Aegis】【Reporter-".concat(e,"】上报\n"),t),e===r.CUSTOM)Ae.reportEvent(t);else{var n=Le[e];t.msg&&te(t.msg)&&(t.msg="Error: ".concat(t.msg.toString(),"\nStack: ").concat(t.msg.stack)),Ae.report(oe({},t,{level:n}))}}catch(e){console.log(e)}},reportForComponent:function(e,t){try{Ue[e]||(Ue[e]=new a(function(e,t){return oe({id:e,pvUrl:"",whiteListUrl:"",offlineUrl:"",speedUrl:"",customTimeUrl:"",performanceUrl:"",webVitalsUrl:"",reportApiSpeed:!1,reportAssetSpeed:!1,pagePerformance:!1,webVitals:!1,onError:!1},Se(),Te(),xe(t,e))}(e,Ce))),Ue[e].reportEvent(t)}catch(e){console.log(e)}},setSdkInstanceConfig:function(e){"object"===I(e)&&Ae.setConfig(e)},destroy:function(){Ce.emit(m),Ae.destroy()},config:{filterAjaxStatusError:!0,filterImgLoadError:!0,filterRetError:!0},setConfig:function(e){var t=Ce.config;Ce.config=oe({},t,e)},recordUserTrace:function(e){Ne.length>10&&Ne.shift(),Ne.push(e)},getUserTrace:function(){return Ne},consumeCache:function(e){try{var t=e.slice();console.log("【WebAegis】consumeCache",t),t.map((function(e){if(u=e,"[object ErrorEvent]"===Object.prototype.toString.call(u)){var t=e.error||e.message;Ce.report(r.ERROR,{msg:"Error: ".concat(t.toString(),"\nStack: ").concat(t.stack)})}else if(function(e){return"[object PromiseRejectionEvent]"===Object.prototype.toString.call(e)}(e)){var n=e.reason;te(n)&&(n="Error: ".concat(n.toString(),"\nStack: ").concat(n.stack)),Ce.report(r.PROMISE_ERROR,{msg:"PROMISE_ERROR: ".concat(ie(n))})}else if(function(e){return"undefined"!=typeof Event&&ne(e,Event)}(e)&&e.target)!function(e){return e&&e.tagName&&"SCRIPT"===e.tagName}(e.target)?!function(e){return e&&e.tagName&&"LINK"===e.tagName}(e.target)?function(e){return e&&e.tagName&&"IMG"===e.tagName}(e.target)&&Ce.report(r.IMAGE_ERROR,{msg:"IMG load fail: ".concat(e.target.src)}):Ce.report(r.CSS_ERROR,{msg:"CSS load fail: ".concat(e.target.href)}):Ce.report(r.SCRIPT_ERROR,{msg:"SCRIPT load fail: ".concat(e.target.src)});else if(function(e){return!(!e||!e[c]||"__PRELOAD_FOR_PAGE__"!==e[c])}(e)){var o=e.type,i=e.params;Ce.report(o,i)}else if(function(e){return!(!e||!e[c]||"__PRELOAD_FOR_COMPONENT__"!==e[c])}(e)){var a=e.id,s=e.params;Ce.reportForComponent(a,s)}var u}))}catch(e){Ce.report(r.ERROR,{msg:"Error: ".concat(e.toString(),"\nHook: consumeCache\nStack: ").concat(e.stack)})}},_sdkConfig:{},version:Ie})._sdkConfig=_e(Ce),Ae=new a(Ce._sdkConfig),Ue[Ce._sdkConfig.id]=Ae,Ce.sdkInstance=Ae),Ce}var De=/(?:^|[-_])(\w)/g,He="<Anonymous>",je=function(e,t){if(!e)return He;if(e.$root===e)return"<Root>";var n=e.$options,r=n.name||n._componentTag,o=n.__file;if(!r&&o){var i=o.match(/([^/\\]+)\.vue$/);i&&(r=i[1])}return(r?"<".concat(r.replace(De,(function(e){return e.toUpperCase()})).replace(/[-_]/g,""),">"):He)+(o&&!1!==t?" at ".concat(o):"")},qe=null,Be=null;var Fe,We="BLANK_SCREEN_MONITOR",Ge=!0,Ve=window.requestIdleCallback||function(e){return setTimeout(e,1)},Xe=function(){try{var e=window.navigator.connection.effectiveType;return["slow-2g","2g","3g"].indexOf(e)>-1}catch(e){return!1}}()||function(){try{var e=window.navigator.userAgent;return!(!e.toLowerCase().indexOf("firefox/43")&&!e.toLowerCase().indexOf("chrome/49"))}catch(e){return!1}}()?5e3:2500,Je=["DOM解析超".concat(20,"s"),"onload后".concat(Xe/1e3,"s"),"运行中"];function $e(e,t,n,r,o,i,a){if(!e||o.indexOf(e.tagName)>-1||n>=r||t>i)return n;var c=function(){if(!t)return 0;var n=e.getBoundingClientRect(),r=n.top,o=n.height,i=0;try{a&&Q(a)&&(i+=a(e))}catch(e){console.log(e)}return i+=r>window.innerHeight||o<=0?0:1/Math.pow(2,t-1)}();return[].reduceRight.call(e.children,(function(e,n){return $e(n,t+1,e,r,o,i,a)}),n+c)}var Ke=function(e){return"global-widget-loading full-loading"===e.className||"global-widget-loading part-loading"===e.className||e.hasAttribute("aegis-blank-screen-ignore")?5:0};function Ye(){if(H()){var e=(n=localStorage.getItem(We))?Number(n):0;if(!e)return!1;var t=((new Date).getTime()-e)/1e3;return console.log("isBlockUser",t),t<60}var n;return!1}var ze={0:"点击链接、书签、表单提交、脚本或在地址栏中键入 URL",1:"点击重新加载按钮、location.reload",2:"点击前进或后退按钮",255:"其他来源","-1":"浏览器不支持该 API"};var Qe=window.location.href,Ze="addEventListener",et="removeEventListener";function tt(e,t){var n=new XMLHttpRequest;n.open("POST",e),n.send(t)}function nt(e,t){window.navigator.sendBeacon(e,t)||tt(e,t)}function rt(e){(window.navigator&&Q(window.navigator.sendBeacon)?nt:tt)(P,e)}var ot,it,at={ua:navigator.userAgent,url:window.location.href,userID:U(),title:document.title,time:Date.now(),sdkVersion:Ie,projectVersion:M(),projectName:"@xiaoe/web_aegis_sdk",language:navigator.language,appID:N()};function ct(e,t,n,r){return ie(oe({},at,{type:e,level:t,details:{sdkId:r,aid:localStorage.getItem("AEGIS_ID"),navigationType:ae(),message:n}}))}var st,ut=2500;window[n.RUM_SDK]=a;try{var lt=Me();window[n.WEB_AEGIS]||(window[n.WEB_AEGIS]=lt),function(e,t){var o,a=t.rootSelector,c=void 0===a?"#common_template_mounted_el_container":a,s=t.threshold,u=void 0===s?1.5:s;function l(t){if(Ge){Ge=!1,localStorage.setItem(We,String((new Date).getTime()));var n=N(),o=U();e.report(r.CUSTOM,{name:i.WHITE_SCREEN,ext1:n,ext2:o,ext3:ie({msg:t})})}}function f(e){Ge&&(Fe&&clearTimeout(Fe),Fe=setTimeout((function(){Ve((function(){requestAnimationFrame((function(){var t=Je[e];try{if(!c)return;var n=document.querySelector(c);if(!n)return;var r=$e(n,0,0,u,["SCRIPT","STYLE","META","HEAD"],5,Ke);r<u&&(r>0?setTimeout((function(){var e=$e(n,0,0,u,["SCRIPT","STYLE","META","HEAD"],5,Ke);e<u&&d(t,e,n)}),Xe):d(t,r,n))}catch(e){console.log(e)}}))}))}),Xe))}function d(t,n,r){console.log("【Aegis】applyMeasure".concat(t),n);try{var o=(new Date).getTime()-window.__HTML_PARSE_START_TIME__;if(o<.8*Xe)return;var i=["".concat(c,"的DOM深度得分为").concat(n,"，低于阈值").concat(u,";"),"上报时机：".concat(t),"页面已运行：".concat(o)];try{var a=e.getUserTrace();if(a.length){var s=a.map((function(e){return e.msg})).reduce((function(e,t){return"".concat(e,"\n").concat(t)}));i.push("用户访问路径为：".concat(s))}i.push(ce(r,5))}catch(e){console.log(e)}l(i.join("\n"))}catch(e){l("".concat(c,"的DOM深度得分为").concat(n,"，低于阈值").concat(u," \n ，上报时机：").concat(t,"\n 白屏日志详情解析失败：").concat(e))}}Ye()||(e.on(g,(function(){M()||l("window.".concat(n.TAGNAME,"为空"))})),e.on(h,(function(){setTimeout(f.bind(window,1),Xe),window.MutationObserver&&(o&&o.disconnect(),(o=new window.MutationObserver(f.bind(window,2))).observe(document,{subtree:!0,childList:!0}))})),e.on(m,(function(){o&&o.disconnect(),Fe&&clearTimeout(Fe)})))}(lt,{rootSelector:"#common_template_mounted_el_container",threshold:1.5}),function(e){e.on(g,(function(){var t=window[n.VUE];if(console.log("【Aegis】rewriteVueErrorHandler",t),!t)return console.log("【Aegis】重写 console.error"),void("undefined"!=typeof console&&(qe||(qe=console.error),console.error=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];var i=n[0];i&&i.toString&&i.stack&&e.report(r.ERROR,{msg:"Error: ".concat(i.toString(),"\nStack: ").concat(i.stack,"\n")}),qe&&qe.apply(window,n)}));Be||(Be=t.config.errorHandler),t.config.errorHandler=function(n,o,i){Be&&Be.call(t,n,o,i),console.error(n);var a=function(e){var t;try{t=je(e,!0)}catch(e){t=He}return t}(o),c="Error: ".concat(n.toString(),"\nComponent: ").concat(a,"\nHook: ").concat(i,"\nStack: ").concat(n.stack,"\n");e.report(r.ERROR,{msg:c})}})),e.on(m,(function(){qe&&(console.error=qe),Be&&(window[n.VUE].config.errorHandler=Be)}))}(lt),function(e){function t(){var t,r;e.setSdkInstanceConfig({ext1:N(),ext2:H()?B():U(),ext3:ie(oe({userId:U(),navigationType:ae(),sdkVersion:Ie,tag:M()},(t={},r=window[n.WX],r&&["CLIENT_ENV","CLIENT_TYPE","CLIENT_SYSTEM","SHOP_TYPE_ENV"].forEach((function(e){var n=r[e];n&&(t[e]=n)})),t)))})}function r(){e.setSdkInstanceConfig({ext1:N(),ext2:H()?B():U(),ext3:window[u]?"预渲染":ze[String(ae())]})}e.on(v,t),e.on(y,t),e.on(w,t),e.on(E,t),e.on(R,t),e.on(b,t),e.on(S,r),e.on(x,r),e.on(_,r),e.on(T,(function(){window.__NEED_COMPUTE_FPS__=!1,e.setSdkInstanceConfig({ext1:N(),ext2:window.devicePixelRatio&&"number"==typeof window.devicePixelRatio?window.devicePixelRatio.toFixed(2):"-1",ext3:window.__aegis_fps__})}))}(lt),function(e){function t(t){e.recordUserTrace({type:"routeChange",msg:"".concat(t.type,"路由跳转，从").concat(Qe,"跳转到").concat(window.location.href)}),Qe=window.location.href}e.on(p,(function(){window[Ze]("replaceState",t,!0),window[Ze]("pushState",t,!0),window[Ze]("popstate",t,!0)})),e.on(m,(function(){window[et]("replaceState",t),window[et]("pushState",t),window[et]("popstate",t)})),e.on(v,(function(t){var n=t.logs.msg;try{var r=n.split("\n")[0];n=r}catch(e){console.log(e)}e.recordUserTrace({type:v,msg:"JS执行报错：".concat(n)})})),e.on(y,(function(t){e.recordUserTrace({type:y,msg:t.logs.msg.replace("SCRIPT load fail","JS资源加载失败")})})),e.on(w,(function(t){e.recordUserTrace({type:w,msg:t.logs.msg.replace("IMG load fail","图片资源加载失败")})})),e.on(E,(function(t){e.recordUserTrace({type:E,msg:t.logs.msg.replace("CSS load fail","CSS资源加载失败")})})),e.on(R,(function(t){var n=j(t);e.recordUserTrace({type:R,msg:"".concat(n["req method"],"接口").concat(n["fetch req url"],"请求异常，耗时").concat(n["res duration"])})})),e.on(b,(function(t){e.recordUserTrace({type:b,msg:t.logs.msg.replace("PROMISE_ERROR","未处理的Promise异常")})}))}(lt),function(e){e.on(v,(function(e){rt(ct(v,"Error",e.logs.msg,e.id))})),e.on(O,(function(e){rt(ct(O,"INFO",e,e.id))})),e.on(y,(function(e){rt(ct(y,"Error",e.logs.msg,e.id))})),e.on(w,(function(e){rt(ct(w,"Error",e.logs.msg,e.id))})),e.on(E,(function(e){rt(ct(E,"Error",e.logs.msg,e.id))})),e.on(R,(function(e){e.logs.msg.indexOf(P)>-1||rt(ct(R,"Error",e.logs.msg,e.id))})),e.on(b,(function(e){rt(ct(b,"WARNING",e.logs.msg,e.id))}))}(lt),function(e){if(H()){var t,n=(t=[],it=setInterval((function(){t=[]}),ut),{push:function(o){t.push(o),t.length>5&&(e.reportForComponent("O5m0eIQ603om521QOG",{name:i.SENSE_MESSAGE_Frequently,ext1:"",ext2:"",ext3:"sense message 在 ".concat(2.5," 秒内弹出 ").concat(n.length," 次")}),r())},get length(){return t.length}});e.on(g,(function(){window.MutationObserver&&(ot&&ot.disconnect(),(ot=new window.MutationObserver(o)).observe(document,{subtree:!0,childList:!0}))})),e.on(m,r)}function r(){ot&&ot.disconnect(),it&&clearInterval(it)}function o(e){for(var t=0;t<e.length;t++){var r=e[t],o=r.addedNodes;if("childList"===r.type&&o.length)for(var i=0;i<o.length;i++){a=void 0,((a=o[i].innerHTML)&&a.indexOf("ss-message__warning")>1||a&&a.indexOf("ss-message__error")>1)&&n.push((new Date).getTime())}}var a}}(lt),function(e){function t(t,n){e.reportForComponent("3ol1OHLX0vWWvRO43z",{name:t,ext1:n})}e.on(_,(function(e){var n=e.logs,r=n.url;"static"===n.type&&(r.indexOf(".cossh.myqcloud.com")>-1&&t("V4 COS 源站",r),r.indexOf(".cos.ap-")>-1&&t("V5 COS 源站",r),r.indexOf(".cos.accelerate.myqcloud.com")>-1&&t("全球加速",r),r.indexOf(".picsh.myqcloud.com")>-1&&t("数据万象源站",r))}))}(lt),lt.emit(p),st=function(){return lt.emit(g)},"loading"===document.readyState?document.addEventListener("readystatechange",(function(){"interactive"===document.readyState&&setTimeout(st,0)})):setTimeout(st,0),function(e){"complete"!==document.readyState?window.addEventListener("load",(function(){setTimeout((function(){e()}),0)}),!1):e()}((function(){return lt.emit(h)}))}catch(e){console.log(e)}return Me()}();
