!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).imagex=t()}(this,function(){"use strict";var e=function(){return e=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},e.apply(this,arguments)};function t(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}function r(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}u((n=n.apply(e,t||[])).next())})}function n(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=c(0),a.throw=c(1),a.return=c(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(u){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&c[0]?n.return:c[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,c[1])).done)return o;switch(n=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,n=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],n=0}finally{r=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}}function o(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var i,a="xe_webp_is_support",c="|".concat("imageMogr2","/ignore-error/1");!function(e){e.READY="ready",e.DOING="doing",e.DONE="done"}(i||(i={}));var u=["jpg","jpeg","png","bmp","tpg","heif"],l={avator45:{q:50,w:90},avator135:{q:50,w:270,format:"webp"},Default:{q:40,format:"webp"},RichText:{q:80,w:800},CourseList:{q:75,w:360,format:"webp"},CourseList_Sm:{q:75,w:140,format:"webp"},CourseList_Mini:{q:60,w:100,format:"webp"},CourseList_Big:{q:75,w:750,format:"webp"},PC_Banner:{q:90,format:"webp"},H5_Banner:{q:90,w:900,format:"webp"},UploadCover_Big:{q:75,w:600,format:"webp"},UploadCover:{q:75,w:210,format:"webp"},Avator_80:{q:60,w:160,format:"webp"},Avator_24:{q:60,w:48,format:"webp"},Avator_16:{q:60,w:32,format:"webp"}},f={BUCKET:"[a-zA-Z0-9-_]+",OS:["cos","obs","tos"],EXT:["acc"],BNUMBER:"(?!10011692\\b|1251748120\\b|1252670609\\b|1328862751\\b)\\d+",DOMAIN:["knowlink-materials.com","kl-materials.com","xiaoe-materials.com","xe-materials.com","test.knowlink-materials.com","test.kl-materials.com","test.xiaoe-materials.com","test.xe-materials.com"],OVERSEA_BNUMBER:"1328862751"},s="{BUCKET}-cos.cdn.xiaoe-materials.com",p="{BUCKET}-cos.cdn.knowlink-materials.com",d={cos:[["({BUCKET})-({BNUMBER}).picsh.myqcloud.com",s],["({BUCKET})-({BNUMBER}).file.myqcloud.com",s],["({BUCKET})-({BNUMBER}).cossh.myqcloud.com",s],["({BUCKET})-({BNUMBER}).cdn.xiaoeknow.com",s],["({BUCKET})-({BNUMBER}).cos.accelerate.myqcloud.com",s],["({BUCKET})-({BNUMBER}).cos.ap-[^.]*.myqcloud.com",s],["({BUCKET})-({OVERSEA_BNUMBER}).picsh.myqcloud.com",p],["({BUCKET})-({OVERSEA_BNUMBER}).file.myqcloud.com",p],["({BUCKET})-({OVERSEA_BNUMBER}).cossh.myqcloud.com",p],["({BUCKET})-({OVERSEA_BNUMBER}).cdn.xiaoeknow.com",p],["({BUCKET})-({OVERSEA_BNUMBER}).cos.accelerate.myqcloud.com",p],["({BUCKET})-({OVERSEA_BNUMBER}).cos.ap-[^.]*.myqcloud.com",p]]},m=[["({BUCKET})-({OS}).cdn.({DOMAIN})","{BUCKET}-{OS}.cdn.{DOMAIN}"],["({BUCKET})-({EXT}).({OS}).({DOMAIN} )","{BUCKET}-{OS}.cdn.{DOMAIN}"],["({BUCKET}).({OS}).({DOMAIN})","{BUCKET}-{OS}.cdn.{DOMAIN}"]],v=Object.keys(f),g=v.reduce(function(e,t){var r=f[t];return e[t]=Array.isArray(r)?r.join("|"):r,e},{}),w="undefined"!=typeof window&&window.document,b=!w,y=function(){function e(){Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:{}})}return Object.defineProperty(e.prototype,"getItem",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.store[e]||null}}),Object.defineProperty(e.prototype,"setItem",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){this.store[e]=t}}),e}(),h=function(){if(w)try{return window.localStorage}catch(e){return new y}return new y}();var E={checkWebp:function(){return b?Promise.resolve(!1):new Promise(function(e){var t=new Image;t.onload=function(){e(t.width>0&&t.height>0)},t.onerror=function(){e(!1)},t.src="data:image/webp;base64,UklGRi4AAABXRUJQVlA4TCEAAAAvAUAAEB8wAiMwAgSSNtse/cXjxyCCmrYNWPwmHRH9jwMA"})},getStorage:function(e){try{return h.getItem(e)}catch(e){}},setStorage:function(e,t){try{h.setItem(e,t)}catch(e){}}};function A(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),o=0,i=t;o<i.length;o++){var a=i[o];if(null!=a){var c=a;for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&(n[u]=c[u])}}return n}function O(e,t,r){if(void 0===r&&(r=0),null==e)throw new TypeError("arr is null or undefined");var n=e.length;if(0===n)return!1;for(var o=r>=0?r:Math.max(0,n+r);o<n;){if(e[o]===t||t!=t&&e[o]!=e[o])return!0;o++}return!1}function B(e,t,r){if(void 0===r&&(r=0),null==e)throw new TypeError("str is null or undefined");if(null==t)throw new TypeError("searchString is null or undefined");return-1!==e.indexOf(t,r)}var U=function(e,t){return t?B(e,"?")?"".concat(e,"&").concat(t):"".concat(e,"?").concat(t):e};function _(e){if(!B(e,"?"))return{};var t=e.split("?")[1].split("&"),r={};return t.forEach(function(e){var t=e.split("="),n=t[0],o=t[1];r[n]=decodeURIComponent(o)}),r}var x,C=(x=m.map(function(e){return N(e[0],e[1])}),f.OS.forEach(function(e){var t=(d[e]||[]).map(function(t){return N(t[0],t[1],e)});t.length&&x.push.apply(x,t)}),x);function N(t,r,n){return void 0===n&&(n=""),e(e({},S(g,t,n)),{cdnTemplate:r})}function S(e,t,r){void 0===r&&(r="");var n={os:r,match:{},regex:new RegExp(""),transfer:""},o=1,i=t.replace(/{(\w+)}/g,function(t,r){var i=e[r];return i?(n.match[r]=o++,i):t});return n.transfer=i,n.regex=new RegExp(i),n}function T(t,r){var n=r.regex,o=r.match,i=r.cdnTemplate,a=n.exec(t);if(a){var c={},u={};v.forEach(function(e){var t=function(e,t,r){var n=t[r];return n&&void 0!==e[n]?e[n]:""}(a,o,e);c[e.toLowerCase()]=t,u[e]=t});var l=S(u,i);return e(e({},c),{cdn:l.transfer,url:t,replace:a[0]})}return null}var I={};function R(){if("undefined"!=typeof window)return window.__IMAGEX_CONFIG__;if("undefined"!=typeof global)return global.__IMAGEX_CONFIG__;if("undefined"!=typeof getApp){var e=getApp?getApp():{};if(e.globalData)return e.globalData.__IMAGEX_CONFIG__}return I}var M,q=null,j=function(e,t){(void 0===t&&(t={}),"gif"===e&&t.format&&O(u,t.format)&&delete t.format,"webp"===t.format)&&(!function(){if(null!==q)return q;var e=E.getStorage(a);return null!=e&&(q="1"===e)}()&&delete t.format);return t},D=function(e,r){var n,i;void 0===r&&(r={});var a=A({},r),u=e.split("?"),l=u[0],f=o([],u.slice(1),!0).join("?"),s=function(e){var t;return void 0===e&&(e=""),(null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase())||""}(l),p=!!(null===(n=_(e))||void 0===n?void 0:n.sign),d=function(e){for(var t=0,r=C;t<r.length;t++){var n=T(e,r[t]);if(n)return n}return null}(l);if(!d)return e;var m=p?d.replace:d.cdn,v=l.replace(d.replace,m);return(null==a?void 0:a.delUrlParams)?p&&(v=U(v,"sign=".concat(null===(i=_(e))||void 0===i?void 0:i.sign))):v=U(v,f),a.forceNoWebp&&"webp"===a.format&&delete a.format,"svg"===s?v:(j(s,a),U(v,function(e){void 0===e&&(e={});var r=e.type,n=void 0===r?2:r,o=t(e,["type"]),i=Object.keys(o);if(!i.length)return"";var a="".concat("imageView2","/").concat(n);return i.forEach(function(e){O(["w","h","q","format"],e)&&(a+="/".concat(e,"/").concat(o[e]))}),a+=c,encodeURI(a)}(a)))},P=function(){return r(void 0,void 0,void 0,function(){var e,t;return n(this,function(r){switch(r.label){case 0:return[4,((null===(t=R())||void 0===t?void 0:t.checkWebPSupport)||E.checkWebp)()];case 1:return e=r.sent(),E.setStorage(a,e?"1":"0"),[2]}})})};!function(e){e.DEFAULT="default",e.BACKGROUND="background"}(M||(M={}));var k,K={initStatus:i.READY},G={};return K.initStatus=i.READY,K.initPms=new Promise(function(e,t){k=[e,t]}),K.init=function(){return r(void 0,void 0,void 0,function(){var e,t;return n(this,function(r){switch(r.label){case 0:if(null==k||K.initStatus!==i.READY)return[2];e=k[0],t=k[1],r.label=1;case 1:return r.trys.push([1,3,,4]),K.initStatus=i.DOING,[4,P()];case 2:return r.sent(),K.initStatus=i.DONE,e&&e(),[3,4];case 3:return r.sent(),t&&t(),[3,4];case 4:return[2]}})})},K.processUrls=function(t,r,n){var o=l[t];if("custom"==t){o=e(e({},{type:"2",q:"80"}),n)}else{o||(console.error("\n 当前版本imagex不支持场景【".concat(t||" ","】直接使用默认场景【Default】，如有需正常使用功能 \n 【详见 https://fe.xiaoe-tools.com/portal/docs/imagex/imagex.html 】,如果文档内场景表格有对应场景需要进行模板imagex升级到对应版本")),o=l.Default);var i={delUrlParams:!!(null==n?void 0:n.delUrlParams),forceNoWebp:!!(null==n?void 0:n.forceNoWebp)};o=e(e({},o),i)}return Array.isArray(r)?r.map(function(e){return D(e,o)}):D(r,o)},K.sync=function(e,t,r){return void 0===r&&(r={}),K.init(),K.processUrls(e,t,r)},K.async=function(e,t){for(var i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];return r(void 0,o([e,t],i,!0),void 0,function(e,t,r){return void 0===r&&(r={}),n(this,function(n){switch(n.label){case 0:return K.init(),[4,K.initPms];case 1:return n.sent(),[2,K.processUrls(e,t,r)]}})})},K.directive=function(t,o){var i=this;if(void 0===o&&(o={}),!b){var a=o.name||"imagex",c=function(t,o){return r(i,void 0,void 0,function(){var r,i,c,u,l,f,s,p,d,m,v,g,w,b,y,h,E;return n(this,function(n){return r=o.value,i=r[0],c=r[1],u=r[2],l=void 0===u?{}:u,"string"!=typeof c&&(l=c||{},c=t.src),t.__ImagexSrc==c||(f=A({srcAttr:"src",ciConfig:{},delUrlParams:!1,forceNoWebp:!1},l),s=f.srcAttr,p=f.ciConfig,d=f.delUrlParams,m=f.forceNoWebp,v=o.modifiers,i||console.error("\n当前使用指令模式，但无设置对应sense场景，请设置对应场景示例: (v-".concat(a,"=['avator','https://xxx.com/xxx.png']) \n 【详见 https://fe.xiaoe-tools.com/portal/docs/imagex/imagex.html 】")),g="".concat(c,"-").concat(JSON.stringify(o.value)),G[g]=G[g]||K.sync(i,c,e(e({},p),{delUrlParams:d,forceNoWebp:m})),w=G[g],b=function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(e[r]);return t}(M),function(e,t,r){if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var n=e.length,o=0;o<n;){var i=e[o];if(t.call(r,i,o,e))return i;o++}}(b,function(e){return v[e]})===M.BACKGROUND?t.style.backgroundImage="url(".concat(w,")"):(y=function(e,t){for(var r=t.split("."),n=e,o=0;o<r.length-1;o++)n[r[o]]||(n[r[o]]={}),n=n[r[o]];return[n,r[r.length-1]]}(t,s),h=y[0],E=y[1],t.__ImagexSrc=w,h[E]=w)),[2]})})},u=function(e,t){t.value!=t.oldValue&&c(e,t)};t.directive(a,{inserted:function(e,t){return c(e,t)},update:function(e,t){return u(e,t)},mounted:function(e,t){return c(e,t)},updated:function(e,t){return u(e,t)}})}},K.replaceAllImg=function(e){for(var i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];return r(void 0,o([e],i,!0),void 0,function(e,r,o){var i,a,c,u;return void 0===r&&(r="richText"),n(this,function(n){switch(n.label){case 0:return a=(i=o||{}).srcAttr,c=void 0===a?"src":a,u=t(i,["srcAttr"]),K.init(),[4,K.initPms];case 1:return n.sent(),[2,e.replace(/<img[^>]*>/gi,function(e){var t=e.match(/src=[\'\"]?([^\'\"]*)[\'\"]?/i);if(Array.isArray(t)&&t.length>1){var n=K.sync(r,t[1],u);return e.replace(t[0],"".concat(c,'="').concat(n,'"'))}var o="".concat(c,'="').concat(K.sync("custom","https://commonresource-1252524126.cdn.xiaoeknow.com/image/m1ioijik0iys.png"),'"');return e.replace("<img","<img ".concat(o))})]}})})},K.getGlobalConfig=R,K.setGlobalConfig=function(e){return r(void 0,void 0,void 0,function(){var t;return n(this,function(r){switch(r.label){case 0:return t=function(e){I=e||{};try{if("undefined"!=typeof window)window.__IMAGEX_CONFIG__=e;else if("undefined"!=typeof global)global.__IMAGEX_CONFIG__=e;else if("undefined"!=typeof getApp){var t=getApp?getApp():{};t.globalData&&(t.globalData.__IMAGEX_CONFIG__=e)}return!0}catch(e){return!1}}(e),[4,P()];case 1:return r.sent(),[2,t]}})})},K});
//# sourceMappingURL=imagex.umd.polyfill.js.map
