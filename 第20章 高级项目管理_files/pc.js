!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["global-state"]={})}(this,function(e){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)};function r(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}l((r=r.apply(e,t||[])).next())})}function o(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}function a(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var i=[170,171,172],s={zh:"简体中文","zh-tw":"繁体中文",en:"English",ja:"日本語",ko:"한국어",es:"Español",pt:"português",fr:"Français",de:"Deutsch",hi:"हिन्दी",id:"Indonesia",ms:"Melayu",fil:"Filipino",th:"ไทย",vi:"Tiếng Việt",it:"italiano"};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}window.GlobalState||(window.GlobalState={}),localStorage.getItem("GlobalState")||localStorage.setItem("GlobalState","{}");var c=function(){var e,n=null;function r(e){return!!e&&("object"===t(e)||"function"==typeof e)}function o(e){if(null!==e&&!r(e))throw new TypeError("Object prototype may only be an Object or null: "+e)}var a=Object,i=Boolean(a.create)||!({__proto__:null}instanceof a),s=a.create||(i?function(e){return o(e),{__proto__:e}}:function(e){if(o(e),null===e)throw new SyntaxError("Native Object.create is required to create objects with null prototype");var t=function(){};return t.prototype=e,new t}),l=function(){return null},c=a.getPrototypeOf||([].__proto__===Array.prototype?function(e){var t=e.__proto__;return r(t)?t:null}:l);return e=function(t,u){if(void 0===(this&&this instanceof e?this.constructor:void 0))throw new TypeError("Constructor Proxy requires 'new'");if(!r(t)||!r(u))throw new TypeError("Cannot create proxy with a non-object as target or handler");var f=function(){};n=function(){t=null,f=function(e){throw new TypeError("Cannot perform '".concat(e,"' on a proxy that has been revoked"))}},setTimeout(function(){n=null},0);var p=u;for(var d in u={get:null,set:null,apply:null,construct:null},p){if(!(d in u))throw new TypeError("Proxy polyfill does not support trap '".concat(d,"'"));u[d]=p[d]}"function"==typeof p&&(u.apply=p.apply.bind(p));var h,y=c(t),v=!1,b=!1;"function"==typeof t?(h=function(){var e=this&&this.constructor===h,n=Array.prototype.slice.call(arguments);return f(e?"construct":"apply"),e&&u.construct?u.construct.call(this,t,n):!e&&u.apply?u.apply(t,this,n):e?(n.unshift(t),new(t.bind.apply(t,n))):t.apply(this,n)},v=!0):t instanceof Array?(h=[],b=!0):h=i||null!==y?s(y):{};var w=u.get?function(e){return f("get"),u.get(this,e,h)}:function(e){return f("get"),this[e]},g=u.set?function(e,t){f("set"),u.set(this,e,t,h)}:function(e,t){f("set"),this[e]=t},_=a.getOwnPropertyNames(t),m={};_.forEach(function(e){if(!v&&!b||!(e in h)){var n=a.getOwnPropertyDescriptor(t,e),r={enumerable:Boolean(n.enumerable),get:w.bind(t,e),set:g.bind(t,e)};a.defineProperty(h,e,r),m[e]=!0}});var S=!0;if(v||b){var k=a.setPrototypeOf||([].__proto__===Array.prototype?function(e,t){return o(t),e.__proto__=t,e}:l);y&&k(h,y)||(S=!1)}if(u.get||!S)for(var E in t)m[E]||a.defineProperty(h,E,{get:w.bind(t,E)});return a.seal(t),a.seal(h),h},e.revocable=function(t,r){return{proxy:new e(t,r),revoke:n}},e},u="undefined"==typeof Proxy?l(c):Proxy;function f(e){void 0===e&&(e={});var t=e.method,n=void 0===t?"post":t,r=e.url,o=void 0===r?"":r,a=e.data,i=void 0===a?null:a,s=e.headers,l=void 0===s?{}:s;return new Promise(function(e,t){(function(e){return new Promise(function(t,n){var r=new XMLHttpRequest,o=e.method?e.method.toLowerCase():"get",a=JSON.stringify(e.data||{});r.open(o,e.url),e.headers&&Object.keys(e.headers).forEach(function(t){r.setRequestHeader(t,e.headers[t])}),r.onload=function(){r.status>=200&&r.status<300?t(r.response):n(new Error(r.statusText))},r.onerror=function(){n(new Error("Network Error"))},"post"===o?(r.setRequestHeader("Content-Type","application/json"),r.send(a)):r.send()})})({method:n,url:o,data:i,headers:l}).then(function(n){var r=JSON.parse(n||"{}"),o=r.code,a=r.data;0===o?e(a):t(n)}).catch(function(e){console.error("Request failed:",e),t(e)})})}function p(e){var t=null,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return document.cookie&&(t=document.cookie.match(n))?unescape(t[2]):null}function d(e){if(null===e||"object"!=typeof e)return e;var t;if(Array.isArray(e)){t=[];for(var n=0;n<e.length;n++)t[n]=d(e[n])}else for(var r in t={},e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=d(e[r]));return t}function h(){return JSON.parse(sessionStorage.getItem("GlobalState"))}function y(e,t){var n=h(),r=0;t?r=t:n&&n.expires&&(r=n.expires),sessionStorage.setItem("GlobalState",JSON.stringify({state:e,expires:r}))}function v(e){return f({url:"/xe.micro_page.common.public.data.get/1.0.0",data:{modules:e}})}var b={versionType:window.version_type,appId:window.GlobalState.appId||window.APPID,userId:window.USERID,appEnv:window.GlobalState.appEnv||"pro",orgType:window.__org_type,shopName:window.SHOP_NAME,machineIp:window.MACHINEIP,tagName:window.TAGNAME,aegisId:window.__aegis_id,cdnRetryDomains:window.__cdn_retry_domains,cdnUrlPrefix:window.__cdn_url_prefix,requestId:window.GlobalState.requestId,isNeedLog:window.GlobalState.isNeedLog,transferDomain:window.GlobalState.transferDomain,isPrivateDeploy:!!window.GlobalState.isPrivateDeploy,productLine:window.GlobalState.productLine||"xiaoetong",lang:"elink"===window.GlobalState.productLine?"en":"zh",langMap:s,shopType:window.__shop_type,isTraining:!1,shopInfo:{},userInfo:{},brandInfo:{},sdkUrl:{},shareLink:{}},w={shopInfo:"shop_info",brandInfo:"brand_info",sdkUrl:"sdk_url",userInfo:"user_info",shareLink:"share_link"},g={},_=function(){var e={};for(var t in w)e[t]=1;return e}(),m={lang:{check:function(){return!0},impactFieldsHandler:{lang:function(e){!function(e,t,n,r){void 0===n&&(n=1);var o=new Date(Date.now()+24*n*60*60*1e3),a="".concat(e,"=").concat(t,"; expires=").concat(o.toUTCString(),"; path=/;");r&&location.host.indexOf(r)>-1?document.cookie="".concat(a," domain=").concat(r):document.cookie=a}("lang",e.lang,1,"elink.ai"),p("logintime")&&function(e){f({url:"/xe.account-platform.account.set_account_language",data:{bizData:{language:e.lang}}})}(e)}}}},S={brandInfo:{getterFieldsHandler:function(e,t){var r=e.shopInfo||{},o=null==r.is_hide_logo||r.is_hide_logo,a=e.brandInfo&&e.brandInfo.scene_shop_default||{};if(t.includes(".")){var i=t.split(".")[1],s=i&&e.brandInfo&&e.brandInfo[i]||{};return n(n({},s),{is_hide_logo:o||null==s.is_hide_logo||s.is_hide_logo,brand_name:s.brand_name||a.brand_name||"",brand_logo_url:s.brand_logo_url||a.brand_logo_url||"",brand_logo_text:s.brand_logo_text||a.brand_logo_text||""})}return n({is_hide_logo:o},a)}}},k=function(e){e.isTraining=i.indexOf(e.versionType)>-1,e.lang=p("lang")||function(e){if("elink"!==e)return"zh";var t=navigator.language||"";if(s[t])return t;if(t.startsWith("zh-"))return"zh-cn"===t.toLowerCase()?"zh":"zh-tw";for(var n=["en","es","pt","fr","de","it"],r=0,o=void 0;o=n[r++];)if(t.startsWith(o+"-"))return o;return"en"}(e.productLine)};var E=function(e,t){return r(void 0,void 0,void 0,function(){var n,r,a,i,s;return o(this,function(o){switch(o.label){case 0:n=t.map(function(e){return w[e]}),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,v(n)];case 2:for(a in r=o.sent(),w)(i=r[w[a]])&&(e[a]=i);return[3,4];case 3:return s=o.sent(),console.log("公共数据-公共数据请求失败：",s),[3,4];case 4:return[2]}})})},I=function(e,t,n){return r(void 0,void 0,void 0,function(){var r,i,s,l,c;return o(this,function(o){switch(o.label){case 0:return o.trys.push([0,9,,10]),r=[],i=!1,"string"!=typeof t?[3,3]:t in w?[4,E(e,[t])]:[3,2];case 1:return o.sent(),[3,2];case 2:return r.push(t),[3,8];case 3:return t instanceof Array?(s=[],l=[],t.forEach(function(e){e in w?s.push(e):l.push(e)}),s.length?[4,E(e,s)]:[3,5]):[3,6];case 4:o.sent(),o.label=5;case 5:return r.push.apply(r,t),[3,8];case 6:return[4,E(e,Object.keys(w))];case 7:o.sent(),r.push.apply(r,a(a([],Object.keys(w),!1),Object.keys(g),!1)),i=!0,o.label=8;case 8:return n&&n(r,i),[3,10];case 9:return c=o.sent(),console.log("global-state请求处理失败",c),[3,10];case 10:return[2]}})})},O=function(e,t,n){k(e),e.appId&&t&&setTimeout(function(){I(e,null,n)})};window.GlobalState=function(e){var t=e.ALLOW_MODIFY_FIELDS,a=e.GETTER_FIELDS,i=e.ASYNC_FIELDS,s=e.state,l=e.handleData,c=e.handleFetch,f=e.isForceUpdate,p=e.expand,v=void 0===p?{}:p,b=h()||{},w=b.state;if(w)for(var g in i){var _=w[g];_&&(s[g]=_)}var m=[],S=function(e,t){return new u(e,{set:function(e,n,r){var o=d(e);return e[n]!==r&&(e[n]=r,t.forEach(function(t){var r=t.key;r?r===n&&t.callback(e[r],o[r]):t.callback(e,o)})),!0}})}(s,m),k=!1,E=[],I=[];try{var O=!b.expires||b.expires<Date.now(),x=f||O;x||(E=Object.keys(i),k=!0),l(S,x,function(e,t){E.push.apply(E,e),t&&(k=!0,E=Object.keys(i)),I.forEach(function(e){if(e.isAll)k&&e.resolve(d(S));else{var t={};e.props.forEach(function(e){var n=[e];e.includes(".")&&(n=e.split("."));var r=n[0],o=a[r];i[r]?E.includes(r)&&(t[r]=o?d(o.getterFieldsHandler(S,e)):S[r]):t[r]=S[r]});var n=Object.keys(t).length;if(e.props.length===n){var r=n>1?t:Object.values(t)[0];e.resolve(d(r))}}}),y(S,Date.now()+1e5)})}catch(e){console.log("公共数据sdk报错：",e)}var P=function(e,t){var n=this;if(void 0===t&&(t=!1),"string"==typeof e){var s=[e];e.includes(".")&&(s=e.split("."));var l=s[0],u=a[l];if(!(l in S))return console.warn("公共数据不存在".concat(e)),null;if(!i[l]){var f=s.reduce(function(e,t){return e[t]},S);return d(f)}return new Promise(function(a,i){return r(n,void 0,void 0,function(){var n,r;return o(this,function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),t?[4,c(S,l)]:[3,2];case 1:return o.sent(),y(S),n=s.reduce(function(e,t){return e[t]},S),a(d(u?u.getterFieldsHandler(S,e):n)),[3,3];case 2:E.includes(l)?(n=s.reduce(function(e,t){return e[t]},S),a(d(u?u.getterFieldsHandler(S,e):n))):I.push({resolve:a,props:[e]}),o.label=3;case 3:return[3,5];case 4:return r=o.sent(),i(r),[3,5];case 5:return[2]}})})})}if(e instanceof Array){var p={},h=e.filter(function(e){return!!i[e.includes(".")?e.split(".")[0]:e]}),v=function(){e.forEach(function(e){var t=[e];e.includes(".")&&(t=e.split("."));var n=t[0],r=a[n];p[n]=r?d(r.getterFieldsHandler(S,e)):S[n]})};return h.length?new Promise(function(a,i){return r(n,void 0,void 0,function(){var n,r,s;return o(this,function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),n=h.map(function(e){return e.includes(".")?e.split(".")[0]:e}),t?[4,c(S,n)]:[3,2];case 1:return o.sent(),v(),y(S),a(d(p)),[3,3];case 2:r=!1,n.forEach(function(e){E.includes(e)||(r=!0)}),r?I.push({resolve:a,props:e}):(v(),a(d(p))),o.label=3;case 3:return[3,5];case 4:return s=o.sent(),i(s),[3,5];case 5:return[2]}})})}):(v(),d(p))}console.error("参数异常")},j=function(e){var t=this;return new Promise(function(n,a){return r(t,void 0,void 0,function(){var t;return o(this,function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),e?[4,c(S)]:[3,2];case 1:return r.sent(),y(S),n(d(S)),[3,3];case 2:k?n(d(S)):I.push({resolve:n,isAll:!0}),r.label=3;case 3:return[3,5];case 4:return t=r.sent(),a(t),[3,5];case 5:return[2]}})})})},A=function(e){for(var n in e)if(void 0!==S[n]){var r=t[n];if(r&&r.check(S))for(var o in S[n]=e[n],r.impactFieldsHandler)r.impactFieldsHandler[o](S);else console.error("".concat(n,"不支持更改"))}y(S)},D=function(e,t){m.push({callback:e,key:t})},T=function(e){m=m.filter(function(t){return t.callback!==e})},F=window.GlobalState.caches;return F&&F.forEach(function(e){return r(void 0,void 0,void 0,function(){var t,n,r;return o(this,function(o){switch(o.label){case 0:if("get"!==e.type)return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,P(e.params.props,e.params.isAsync)];case 2:return n=o.sent(),e.resolve(n),[3,4];case 3:return t=o.sent(),console.log("执行预加载get失败",t),[3,4];case 4:return[3,11];case 5:if("getAll"!==e.type)return[3,10];o.label=6;case 6:return o.trys.push([6,8,,9]),[4,j(e.params.isAsync)];case 7:return n=o.sent(),e.resolve(n),[3,9];case 8:return r=o.sent(),console.log("执行预加载getAll失败",r),[3,9];case 9:return[3,11];case 10:"set"===e.type?A(e.params.props):"$on"===e.type?D(e.params.callback,e.params.key):"$off"===e.type&&T(e.params.callback),o.label=11;case 11:return[2]}})})}),Object.freeze(n({get:P,getAll:j,set:A,$on:D,$off:T},v))}({ALLOW_MODIFY_FIELDS:m,GETTER_FIELDS:S,ASYNC_FIELDS:_,state:b,handleData:O,handleFetch:I,isForceUpdate:!1,expand:{loadLocales:function(e){var t=window.GlobalState.get("lang");return e[t]?e[t]():Promise.resolve(null)}}}),Object.defineProperty(window,"GlobalState",{writable:!1});var x=window.GlobalState;e.default=x,e.fetchCommonData=E,e.handleData=O,e.handleFetch=I,Object.defineProperty(e,"__esModule",{value:!0})});
